<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="pt-BR" xmlns:fb="http://www.facebook.com/2008/fbml" xmlns:og="http://opengraphprotocol.org/schema/">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="pt-BR" xmlns:fb="http://www.facebook.com/2008/fbml" xmlns:og="http://opengraphprotocol.org/schema/">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="pt-BR" xmlns:fb="http://www.facebook.com/2008/fbml" xmlns:og="http://opengraphprotocol.org/schema/">
<!--<![endif]-->
<head>
<base href="https://rafaelbiriba.com/blogwp.html" />

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Desenvolvimento | Rafael Biriba Blog - Part 2</title>
	
	
	<!--[if lt IE 9]>
	<script src="https://rafaelbiriba.com/wp-content/themes/twentyfourteen/js/html5.js"></script>
	<![endif]-->
	
<!-- All in One SEO Pack 2.3.8 by Michael Torbert of Semper Fi Web Design[576,631] -->
<meta name="keywords"  content="browser,cross-document,cross-domain,html5,iframe,javascript,mensagem,messaging,postmessage,desenvolvimento,codigo,net-sftp,net-ssh,progress,progresso,ruby,rubygems,sftp,upload,conexão,connection,rufus,scheduler,timeout,automatizado,batch,codec,converter,ffmpeg,iphone,libfaac,libx264,mov,mp4,multimedia,script,video,Áudio e vídeo,cloud,cloudcrowd,crowd,gem,json,parallel encoding,alert,ano novo,natal,php,historico,log,logger,registro,armazenamento,codificação,código de barras,decifrar,kaywa,leitura,qr,qr code,scanner,tecnologia,google chart api,hpricot,programação,ruby on rails,rubyonrails,web,online,programar,rails" />
<meta name="robots" content="noindex,follow" />

<link rel='next' href='https://rafaelbiriba.com/category/desenvolvimento/page/3' />

<link rel="canonical" href="https://rafaelbiriba.com/category/desenvolvimento/page/2" />
<!-- /all in one seo pack -->



		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.rafaelbiriba.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.5.3"}};
			!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;if(!g||!g.fillText)return!1;switch(g.textBaseline="top",g.font="600 32px Arial",a){case"flag":return g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3;case"diversity":return g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,d=c[0]+","+c[1]+","+c[2]+","+c[3],g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e;case"simple":return g.fillText(h(55357,56835),0,0),0!==g.getImageData(16,16,1,1).data[0];case"unicode8":return g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='wgs-css'  href='https://rafaelbiriba.com/wp-content/plugins/wp-google-search/wgs.css?ver=4.5.3' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='https://rafaelbiriba.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='wp-pagenavi-css'  href='https://rafaelbiriba.com/wp-content/plugins/wp-pagenavi/pagenavi-css.css?ver=2.70' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='https://rafaelbiriba.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='twentyfourteen-lato-css'  href='https://fonts.googleapis.com/css?family=Lato%3A300%2C400%2C700%2C900%2C300italic%2C400italic%2C700italic&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='https://rafaelbiriba.com/wp-content/themes/twentyfourteen/genericons/genericons.css?ver=3.0.3' type='text/css' media='all' />
<link rel='stylesheet' id='twentyfourteen-style-css'  href='https://rafaelbiriba.com/wp-content/themes/twentyfourteen/style.css?ver=4.5.3' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentyfourteen-ie-css'  href='https://rafaelbiriba.com/wp-content/themes/twentyfourteen/css/ie.css?ver=20131205' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='github-profile-octicons-css'  href='https://rafaelbiriba.com/wp-content/plugins/github-profile-widget/css/octicons/octicons.css?ver=4.5.3' type='text/css' media='all' />
<link rel='stylesheet' id='github-profile-widget-styles-css'  href='https://rafaelbiriba.com/wp-content/plugins/github-profile-widget/css/widget.css?ver=4.5.3' type='text/css' media='all' />
<link rel='stylesheet' id='A2A_SHARE_SAVE-css'  href='https://rafaelbiriba.com/wp-content/plugins/add-to-any/addtoany.min.css?ver=1.12' type='text/css' media='all' />
<link rel='stylesheet' id='fbSEOStylesheet-css'  href='https://rafaelbiriba.com/wp-content/plugins/seo-facebook-comments/assets/fbseo-style.css?ver=4.5.3' type='text/css' media='all' />
<!-- This site uses the Google Analytics by MonsterInsights plugin v5.5.2 - Universal enabled - https://www.monsterinsights.com/ -->
<script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

	__gaTracker('create', 'UA-7346716-1', 'auto');
	__gaTracker('set', 'forceSSL', true);
	__gaTracker('send','pageview');

</script>
<!-- / Google Analytics by MonsterInsights -->
<script type='text/javascript' src='https://rafaelbiriba.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://rafaelbiriba.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='https://rafaelbiriba.com/wp-content/plugins/content-slide/js/coin-slider.js?ver=4.5.3'></script>
<link rel='https://api.w.org/' href='https://rafaelbiriba.com/wp-json/' />

 


<script type="text/javascript"><!--
var a2a_config=a2a_config||{},wpa2a={done:false,html_done:false,script_ready:false,script_load:function(){var a=document.createElement('script'),s=document.getElementsByTagName('script')[0];a.type='text/javascript';a.async=true;a.src='https://static.addtoany.com/menu/page.js';s.parentNode.insertBefore(a,s);wpa2a.script_load=function(){};},script_onready:function(){wpa2a.script_ready=true;if(wpa2a.html_done)wpa2a.init();},init:function(){for(var i=0,el,target,targets=wpa2a.targets,length=targets.length;i<length;i++){el=document.getElementById('wpa2a_'+(i+1));target=targets[i];a2a_config.linkname=target.title;a2a_config.linkurl=target.url;a2a_config.linkmedia=target.media;if(el){a2a.init('page',{target:el});el.id='';}wpa2a.done=true;}wpa2a.targets=[];}};a2a_config.callbacks=a2a_config.callbacks||[];a2a_config.callbacks.push({ready:wpa2a.script_onready});a2a_config.templates=a2a_config.templates||{};a2a_localize = {
	Share: "Compartilhar",
	Save: "Salvar",
	Subscribe: "Inscrever",
	Email: "Email",
	Bookmark: "Favoritos",
	ShowAll: "Mostrar tudo",
	ShowLess: "Mostrar menos",
	FindServices: "Procurar serviço(s)",
	FindAnyServiceToAddTo: "Encontrar rapidamente qualquer serviço para",
	PoweredBy: "Serviço fornecido por",
	ShareViaEmail: "Share via email",
	SubscribeViaEmail: "Subscribe via email",
	BookmarkInYourBrowser: "Adicionar aos favoritos",
	BookmarkInstructions: "Press Ctrl+D or \u2318+D to bookmark this page",
	AddToYourFavorites: "Adicionar a favoritos",
	SendFromWebOrProgram: "Send from any email address or email program",
	EmailProgram: "Email program",
	More: "More&#8230;"
};

//--></script>
<script type="text/javascript">
	var $jquery = jQuery.noConflict(); 
	$jquery(document).ready(function() 
	{
		$jquery('#wpcontent_slider').coinslider(
	{ 
	width: 980, 
	height: 370, 
	spw: 7, 
	sph: 5, 
	delay: 3000, 
	sDelay: 30, 
	opacity: 0.7, 
	titleSpeed: 500, 
	effect: 'random', 
	navigation: true, 
	links : true, 
	hoverPause: true });
		});
	</script>
<style type="text/css" media="screen">
		
#wpcontent_slider_container
{
	overflow: hidden; position: relative; padding:0px;margin:0px; text-align:center; width:980px !important;
	height:370px !important;
}
#wpcontent_slider 
{ overflow: hidden; position: relative; font-family:\'Trebuchet MS\', Helvetica, sans-serif;border:0px solid #ffffff; text-align:left;}
#wpcontent_slider a,#wpcontent_slider a img { border: none; text-decoration: none; outline: none; }
#wpcontent_slider h4,#wpcontent_slider h4 a 
{margin: 0px;padding: 0px; font-family: 'Trebuchet MS', Helvetica, sans-serif;
text-decoration:none;font-size: 18px; color:#ffffff;}
#wpcontent_slider .cs-title {width: 100%;padding: 10px; background: #ffffff; color: #000000; font-family: 'Trebuchet MS', Helvetica, sans-serif; font-size: 12px; letter-spacing: normal;line-height: normal;}
#wpcontent_slider_container .cs-prev,#wpcontent_slider_container .cs-next {font-weight: bold;background: #000000;
font-size: 28px; font-family: "Courier New", Courier, monospace; color: #ffffff !important;
padding: 0px 10px;-moz-border-radius: 5px;-khtml-border-radius: 5px;-webkit-border-radius: 5px;}
#wpcontent_slider_container .cs-buttons { font-size: 0px; padding: 10px 0px 10px 0px;
margin:0px auto; float:left;clear:left;
}
#wpcontent_slider_container .cs-buttons a { outline:none; margin-left: 5px; height: 10px; width: 10px; float: left; border: 1px solid #000000; color: #000000; text-indent: -1000px; 
}
#wpcontent_slider_container .cs-active { background-color: #000000; color: #FFFFFF; }
#wpcs_link_love,#wpcs_link_love a{display:none;}
</style>
<!-- End Content Slider Settings -->


		<style type="text/css">
			.cbd {
				position: fixed;
				left: 5px;
				bottom: 5px;
			}
			.cbd a img {
				border: 0;
			}
		</style>
	<meta property='fb:admins' content='1644160548' /><meta property='og:title' content='Desenvolvimento - Rafael Biriba Blog' /><meta property='og:site_name' content='Rafael Biriba Blog' /><meta property='og:url' content='https://rafaelbiriba.com/2010/11/27/html5-trocando-mensagens-entre-a-pagina-e-iframes.html' /><meta property='og:type' content='article' /><meta property='fb:app_id' content='589867447707428'>
	<link rel="stylesheet" href="https://rafaelbiriba.com/wp-content/plugins/shutter-reloaded/shutter-reloaded.css?ver=2.4" type="text/css" media="screen" />
	<style type='text/css'>
div#shNavBar a {color: #000000;}
div#shNavBar {background-color:#ffff00;}
div#shNavBar {color:#000000;}
div#shDisplay div#shTitle {color:#ffff00;}
</style>
<script type="text/javascript">
	window._wp_rp_static_base_url = 'https://wprp.zemanta.com/static/';
	window._wp_rp_wp_ajax_url = "https://rafaelbiriba.com/wp-admin/admin-ajax.php";
	window._wp_rp_plugin_version = '3.6';
	window._wp_rp_post_id = '2428';
	window._wp_rp_num_rel_posts = '5';
	window._wp_rp_thumbnails = false;
	window._wp_rp_post_title = 'HTML5%3A+Trocando+mensagens+entre+a+p%C3%A1gina+e+iframes';
	window._wp_rp_post_tags = ['browser', 'messaging', 'cross-document', 'postmessage', 'cross-domain', 'html5', 'iframe', 'javascript', 'mensagem', 'desenvolvimento', 'html5', 'javascript', 'safari', 'sem', 'adsens', 'el', 'googl', 'opera', 'de', 'na', 'html', 'internet', 'foi', 'os', 'uma', 'html5', 'evita'];
	window._wp_rp_promoted_content = true;
</script>
<script type="text/javascript" src="https://wprp.zemanta.com/static/js/loader.js?version=3.6" async></script>
</head>

<body class="archive paged category category-desenvolvimento category-44 paged-2 category-paged-2 masthead-fixed list-view">
<div id="page" class="hfeed site">
	
	<header id="masthead" class="site-header" role="banner">
		<div class="header-main">
			<h1 class="site-title"><a href="https://rafaelbiriba.com/blogwp.html" rel="home">Rafael Biriba Blog</a></h1>

			<div class="search-toggle">
				<a href="#search-container" class="screen-reader-text" aria-expanded="false" aria-controls="search-container">Pesquisar</a>
			</div>

			<nav id="primary-navigation" class="site-navigation primary-navigation" role="navigation">
				<button class="menu-toggle">Menu principal</button>
				<a class="screen-reader-text skip-link" href="#content">Pular para o conteúdo</a>
				<div id="primary-menu" class="nav-menu"><ul><li class="page_item page-item-3171"><a href="https://rafaelbiriba.com/search_gcse">Busca</a></li><li class="page_item page-item-101"><a href="https://rafaelbiriba.com/contatos">Contatos</a></li><li class="page_item page-item-1251"><a href="https://rafaelbiriba.com/twitter">Twitter</a></li></ul></div>
			</nav>
		</div>

		<div id="search-container" class="search-box-wrapper hide">
			<div class="search-box">
				<form role="search" method="get"
    class="search-form" action="https://rafaelbiriba.com//search_gcse">
    <div>
        <label class="screen-reader-text" for="s"></label>
        <input type="text" value="" name="q" id="q" />
        <input type="submit" id="searchsubmit"
            value="Pesquisar" />
    </div>
</form>
			</div>
		</div>
	</header><!-- #masthead -->

	<div id="main" class="site-main">

	<section id="primary" class="content-area">
		<div id="content" class="site-content" role="main">

			
			<header class="archive-header">
				<h1 class="archive-title">Arquivo da categoria: Desenvolvimento</h1>

							</header><!-- .archive-header -->

			
<article id="post-2428" class="post-2428 post type-post status-publish format-standard hentry category-desenvolvimento category-html5 category-javascript tag-browser tag-cross-document tag-cross-domain tag-html5-2 tag-iframe tag-javascript tag-mensagem tag-messaging tag-postmessage">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/desenvolvimento" rel="category tag">Desenvolvimento</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/html5" rel="category tag">HTML5</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/javascript" rel="category tag">Javascript</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2010/11/27/html5-trocando-mensagens-entre-a-pagina-e-iframes.html" rel="bookmark">HTML5: Trocando mensagens entre a página e iframes</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2010/11/27/html5-trocando-mensagens-entre-a-pagina-e-iframes.html" rel="bookmark"><time class="entry-date" datetime="2010-11-27T14:00:31+00:00">27/11/2010</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2010/11/27/html5-trocando-mensagens-entre-a-pagina-e-iframes.html#comments"><span class="dsq-postid" data-dsqidentifier="2428 https://rafaelbiriba.com/?p=2428">1 Comentário</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		
<p><img class="size-full wp-image-2432 alignright" title="HTML5" src="https://rafaelbiriba.com/wp-content/uploads/2010/11/html5.jpg" alt="" width="275" height="436" srcset="https://rafaelbiriba.com/wp-content/uploads/2010/11/html5.jpg 275w, https://rafaelbiriba.com/wp-content/uploads/2010/11/html5-189x300.jpg 189w" sizes="(max-width: 275px) 100vw, 275px" /></p>
<p style="text-align: justify;">Por questões de segurança e privacidade, os navegadores impedem que haja comunicação entre os conteúdo de diferentes domínios. Ou seja, scripts em diferentes dominios (cross-domain) não podem se interagir.</p>
<p style="text-align: justify;">Na prática seria assim&#8230; Já imaginou, se um simples anúncio do google adsense, pudesse controlar a  página em que ele foi colocado ? Ele iria alterar o background, trocar  titulos na página e bagunçar tudo.</p>
<p style="text-align: justify;">Por isso essa é uma importante funcionalidade nos navegadores, pois evita com que páginas desconhecidas (em domínio diferente) de controlar a página atual em que está visitando.</p>
<p style="text-align: justify;">Com o HTML5, podemos contornar esse problema facilmente. Utilizando o <a title="http://dev.w3.org/html5/postmsg/" href="http://dev.w3.org/html5/postmsg/" target="_blank">Cross-document messaging</a>, podemos estabelecer comunicação entre páginas e documentos no html, sem se procupar com a origem do domínio. Foi desenvolvido justamente para permitir essa comunicação, sem colocar em risco a segurança da página. (cross-site scripting   attacks).</p>
<p style="text-align: justify;">Cross-site messaging funciona apenas no HTML5, e está disponível nas seguintes versões de navegadores:</p>
<ul style="text-align: justify;">
	<li> Internet Explorer 8.0+</li>
	<li> Firefox 3.0+</li>
	<li> Safari 4.0+</li>
	<li> Google Chrome 1.0+</li>
	<li> Opera 9.5+</li>
</ul>
<p style="text-align: justify;">Vejamos então um exemplo prático:</p>
<p style="text-align: justify;">Digamos que em sua página inicial, você tem o seguinte iframe.</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
</pre></td><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #339933;">&lt;</span>iframe id<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;exemplo-iframe&quot;</span> src<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;http://www.exemplo.com/teste.html&quot;</span><span style="color: #339933;">&gt;&lt;/</span>iframe<span style="color: #339933;">&gt;</span></pre></td></tr></table></div>



<p style="text-align: justify;">Se você quiser mandar o titulo do seu site para o iframe, você precisa usar o cross-document messaging pois ele está em um outro domínio. Veja abaixo como você faria para disparar essa mensagem:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
</pre></td><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #339933;">&lt;</span>script language<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;javascript&quot;</span><span style="color: #339933;">&gt;</span>
<span style="color: #000066; font-weight: bold;">var</span> iframe <span style="color: #339933;">=</span> document.<span style="color: #660066;">getElementById</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;exemplo-iframe&quot;</span><span style="color: #009900;">&#41;</span>.<span style="color: #660066;">contentWindow</span><span style="color: #339933;">;</span>
iframe.<span style="color: #660066;">postMessage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;Titulo do Site&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">&quot;*&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
<span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span></pre></td></tr></table></div>



<p style="text-align: justify;">Na linha 2 é onde obtemos o controle do iframe. Na linha 3 é onde disparamos a mensagem. Note que estamos passando um &#8220;*&#8221; como segundo argumento do postMessage, o que significa que a mensagem é enviada para todos os domínios. Poderiamos ser mais específicos e disparar apenas para o domínio do iframe (exemplo.com).</p>
<p style="text-align: justify;">Agora, no lado do iframe, só falta receber essa mensagem. Veja abaixo o exemplo do código que o iframe deve carregar:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #339933;">&lt;</span>script language<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;javascript&quot;</span><span style="color: #339933;">&gt;</span>
<span style="color: #000066; font-weight: bold;">function</span> displayMessage<span style="color: #009900;">&#40;</span>event<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000066; font-weight: bold;">var</span> message <span style="color: #339933;">=</span> event.<span style="color: #660066;">data</span><span style="color: #339933;">;</span>
    alert<span style="color: #009900;">&#40;</span>message<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    event.<span style="color: #660066;">source</span>.<span style="color: #660066;">postMessage</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;Recebido com sucesso!&quot;</span><span style="color: #339933;">,</span>  <span style="color: #3366CC;">&quot;*&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
window.<span style="color: #660066;">addEventListener</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;message&quot;</span><span style="color: #339933;">,</span> displayMessage<span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">false</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span></pre></td></tr></table></div>



<p style="text-align: justify;">Vou começar explicando pela linha 7,  onde é estabelecido o listener, que é responsável por &#8220;escutar&#8221; as mensagens recebidas e chamar a função displayMessage. Na linha 3, recebemos a mensagem numa variável. Na linha 4 exibimos ela no alert do javascript. Na linha 5, é disparado uma mensagem para o &#8220;remetente&#8221;, ou seja, podemos enviar uma mensagem para confirmar o recebimento por exemplo.</p>
<p style="text-align: justify;">Lembrando que para que a mensagem enviada na linha 5 seja recebida corretamente pela sua página inicial, você tem que adicionar um listener, da mesma forma que foi feito no iframe. Fazendo assim, é possível fazer trocas de informações entre as páginas de diferentes domínios.</p>
<p style="text-align: justify;">No exemplo acima, qualquer site estaria habilitado em trocar informações com aquela página do iframe (http://www.exemplo.com/teste.html) e dependendo do contexto e de como foi implementado, pode vir a ser uma falha de segurança, portanto, utilize com cuidado.</p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_1"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2010/11/27/html5-trocando-mensagens-entre-a-pagina-e-iframes.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2010/11/27/html5-trocando-mensagens-entre-a-pagina-e-iframes.html" data-text="HTML5: Trocando mensagens entre a página e iframes"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F11%2F27%2Fhtml5-trocando-mensagens-entre-a-pagina-e-iframes.html&amp;linkname=HTML5%3A%20Trocando%20mensagens%20entre%20a%20p%C3%A1gina%20e%20iframes" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F11%2F27%2Fhtml5-trocando-mensagens-entre-a-pagina-e-iframes.html&amp;linkname=HTML5%3A%20Trocando%20mensagens%20entre%20a%20p%C3%A1gina%20e%20iframes" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a>
<script type="text/javascript"><!--
if(wpa2a)wpa2a.script_load();
//--></script>
</div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/browser" rel="tag">browser</a><a href="https://rafaelbiriba.com/tag/cross-document" rel="tag">cross-document</a><a href="https://rafaelbiriba.com/tag/cross-domain" rel="tag">cross-domain</a><a href="https://rafaelbiriba.com/tag/html5-2" rel="tag">html5</a><a href="https://rafaelbiriba.com/tag/iframe" rel="tag">iframe</a><a href="https://rafaelbiriba.com/tag/javascript" rel="tag">Javascript</a><a href="https://rafaelbiriba.com/tag/mensagem" rel="tag">mensagem</a><a href="https://rafaelbiriba.com/tag/messaging" rel="tag">messaging</a><a href="https://rafaelbiriba.com/tag/postmessage" rel="tag">postmessage</a></span></footer></article><!-- #post-## -->

<article id="post-2337" class="post-2337 post type-post status-publish format-standard hentry category-desenvolvimento category-ruby tag-codigo tag-desenvolvimento tag-net-sftp tag-net-ssh tag-progress tag-progresso tag-ruby tag-rubygems tag-sftp tag-upload">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/desenvolvimento" rel="category tag">Desenvolvimento</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/ruby" rel="category tag">Ruby</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2010/11/18/net-sftp-calculando-o-progresso-do-upload.html" rel="bookmark">Net-SFTP: Calculando o progresso do upload</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2010/11/18/net-sftp-calculando-o-progresso-do-upload.html" rel="bookmark"><time class="entry-date" datetime="2010-11-18T10:40:29+00:00">18/11/2010</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2010/11/18/net-sftp-calculando-o-progresso-do-upload.html#comments"><span class="dsq-postid" data-dsqidentifier="2337 https://rafaelbiriba.com/?p=2337">2 Comentários</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		
<p style="text-align: justify;"><a href="https://rafaelbiriba.com/wp-content/uploads/2010/09/ruby-box.png"><img class="alignright size-full wp-image-2273" title="ruby-box" src="https://rafaelbiriba.com/wp-content/uploads/2010/09/ruby-box.png" alt="" width="150" height="150" /></a>Estou escrevendo esse post, para complementar o <a title="https://rafaelbiriba.com/2010/09/24/problema-no-net-sftp-timeout-para-o-upload.html" href="https://rafaelbiriba.com/2010/09/24/problema-no-net-sftp-timeout-para-o-upload.html" target="_blank">post sobre o timeout do net-sftp</a>, onde fiquei devendo essa a solução de calculo do progresso&#8230;</p>
<p style="text-align: justify;">Para obter o progresso durante o upload, você precisa usar o callback do método upload! e jogar numa variável os valores do tamanho local e do tamanho do arquivo no destino.</p>
<p style="text-align: justify;">Vejamos um pequeno exemplo, retirado da <a title="http://net-ssh.rubyforge.org/sftp/v2/api/classes/Net/SFTP/Operations/Upload.html" href="http://net-ssh.rubyforge.org/sftp/v2/api/classes/Net/SFTP/Operations/Upload.html" target="_blank">documentação</a>:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'rubygems'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'net/sftp'</span>
<span style="color:#6666ff; font-weight:bold;">Net::SFTP</span>.<span style="color:#9900CC;">start</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">'192.168.0.2'</span>, <span style="color:#996600;">'rafaelbiriba'</span>, <span style="color:#006600; font-weight:bold;">&#123;</span>:password <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">'teste'</span>, <span style="color:#ff3333; font-weight:bold;">:timeout</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">3</span><span style="color:#006600; font-weight:bold;">&#125;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>sftp<span style="color:#006600; font-weight:bold;">|</span>
  sftp.<span style="color:#9900CC;">upload</span>!<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;/Users/rafaelbiriba/Projects/temp/video-teste-sftp.mp4&quot;</span>, <span style="color:#996600;">&quot;/home/rafaelbiriba/video-teste-sftp.mp4&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>event, uploader, <span style="color:#006600; font-weight:bold;">*</span>args<span style="color:#006600; font-weight:bold;">|</span>
    <span style="color:#9966CC; font-weight:bold;">case</span> event
    <span style="color:#9966CC; font-weight:bold;">when</span> :<span style="color:#CC0066; font-weight:bold;">open</span> <span style="color:#9966CC; font-weight:bold;">then</span>
      <span style="color:#008000; font-style:italic;"># args[0] : file metadata</span>
      <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;starting upload: #{args[0].local} -&gt; #{args[0].remote} (#{args[0].size} bytes}&quot;</span>
    <span style="color:#9966CC; font-weight:bold;">when</span> <span style="color:#ff3333; font-weight:bold;">:put</span> <span style="color:#9966CC; font-weight:bold;">then</span>
      <span style="color:#008000; font-style:italic;"># args[0] : file metadata</span>
      <span style="color:#008000; font-style:italic;"># args[1] : byte offset in remote file</span>
      <span style="color:#008000; font-style:italic;"># args[2] : data being written (as string)</span>
      <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;writing #{args[2].length} bytes to #{args[0].remote} starting at #{args[1]}&quot;</span>
    <span style="color:#9966CC; font-weight:bold;">when</span> <span style="color:#ff3333; font-weight:bold;">:finish</span> <span style="color:#9966CC; font-weight:bold;">then</span>
      <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;all done!&quot;</span>
    <span style="color:#9966CC; font-weight:bold;">end</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></td></tr></table></div>



<p style="text-align: justify;">No exemplo acima podemos verificar:</p>
<ul style="text-align: justify;">
	<li>Ao abrir a conexão (when open), podemos chamar <strong>args[0].size</strong> e obter o tamanho total do arquivo</li>
	<li>Durante a transferência (when put), ao chamar <strong>args[1]</strong> podemos obter o tamanho do arquivo remoto</li>
</ul>
<p style="text-align: justify;">Com isso, quando o tamanho total do arquivo for igual ao tamanho do arquivo remoto, então o upload estará terminado (100%). Para obter as porcentagens, basta fazer o cálculo.<br /><br />Confira no exemplo abaixo:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'rubygems'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'net/sftp'</span>
<span style="color:#0066ff; font-weight:bold;">@total_size</span> = <span style="color:#006666;">0</span>
<span style="color:#0066ff; font-weight:bold;">@remote_size</span> = <span style="color:#006666;">0</span>
<span style="color:#0066ff; font-weight:bold;">@current_progress</span> = <span style="color:#006666;">0</span>
&nbsp;
<span style="color:#9966CC; font-weight:bold;">def</span> update_sftp_progress
  progress = <span style="color:#006600; font-weight:bold;">&#40;</span>@remote_size<span style="color:#006600; font-weight:bold;">*</span><span style="color:#006666;">100</span><span style="color:#006600; font-weight:bold;">&#41;</span><span style="color:#006600; font-weight:bold;">/</span>@total_size<span style="color:#006600; font-weight:bold;">&#41;</span>
  <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#0066ff; font-weight:bold;">@current_progress</span> <span style="color:#006600; font-weight:bold;">&lt;</span> progress <span style="color:#9966CC; font-weight:bold;">then</span>
    <span style="color:#0066ff; font-weight:bold;">@current_progress</span> = progress
    <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;Uploading: #{@current_progress}%&quot;</span> 
  <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
<span style="color:#6666ff; font-weight:bold;">Net::SFTP</span>.<span style="color:#9900CC;">start</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">'192.168.0.2'</span>, <span style="color:#996600;">'rafaelbiriba'</span>, <span style="color:#006600; font-weight:bold;">&#123;</span>:password <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">'teste'</span>, <span style="color:#ff3333; font-weight:bold;">:timeout</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">3</span><span style="color:#006600; font-weight:bold;">&#125;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>sftp<span style="color:#006600; font-weight:bold;">|</span>
 sftp.<span style="color:#9900CC;">upload</span>!<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;/Users/rafaelbiriba/Projects/temp/video-teste-sftp.mp4&quot;</span>, <span style="color:#996600;">&quot;/home/rafaelbiriba/video-teste-sftp.mp4&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>event, uploader, <span style="color:#006600; font-weight:bold;">*</span>args<span style="color:#006600; font-weight:bold;">|</span>
   <span style="color:#9966CC; font-weight:bold;">case</span> event
     <span style="color:#9966CC; font-weight:bold;">when</span> :<span style="color:#CC0066; font-weight:bold;">open</span> <span style="color:#9966CC; font-weight:bold;">then</span>
       <span style="color:#0066ff; font-weight:bold;">@total_size</span> = args<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#006666;">0</span><span style="color:#006600; font-weight:bold;">&#93;</span>.<span style="color:#9900CC;">size</span>
       <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;Starting upload...&quot;</span>
     <span style="color:#9966CC; font-weight:bold;">when</span> <span style="color:#ff3333; font-weight:bold;">:put</span> <span style="color:#9966CC; font-weight:bold;">then</span>
       <span style="color:#0066ff; font-weight:bold;">@remote_size</span> = args<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#006666;">1</span><span style="color:#006600; font-weight:bold;">&#93;</span>
       update_sftp_progress
     <span style="color:#9966CC; font-weight:bold;">when</span> <span style="color:#ff3333; font-weight:bold;">:finish</span> <span style="color:#9966CC; font-weight:bold;">then</span>
       <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;Finished!&quot;</span>
     <span style="color:#9966CC; font-weight:bold;">end</span>
   <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></td></tr></table></div>



<p style="text-align: justify;">Toda vez que o arquivo no destino for incrementado, o evento (:put) será disparado, chamando o método update_sftp_progress.</p>
<p style="text-align: justify;">Nesse método é feito o cálculo da porcentagem(ver no exemplo acima). Ao invés de imprimir a porcentagem(com puts), você também pode salvar no banco de dados, ou utilizar o valor para fazer uma barra de progresso.</p>
<p style="text-align: justify;">Espero ter ajudado, 😉</p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_2"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2010/11/18/net-sftp-calculando-o-progresso-do-upload.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2010/11/18/net-sftp-calculando-o-progresso-do-upload.html" data-text="Net-SFTP: Calculando o progresso do upload"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F11%2F18%2Fnet-sftp-calculando-o-progresso-do-upload.html&amp;linkname=Net-SFTP%3A%20Calculando%20o%20progresso%20do%20upload" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F11%2F18%2Fnet-sftp-calculando-o-progresso-do-upload.html&amp;linkname=Net-SFTP%3A%20Calculando%20o%20progresso%20do%20upload" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/codigo" rel="tag">codigo</a><a href="https://rafaelbiriba.com/tag/desenvolvimento" rel="tag">Desenvolvimento</a><a href="https://rafaelbiriba.com/tag/net-sftp" rel="tag">net-sftp</a><a href="https://rafaelbiriba.com/tag/net-ssh" rel="tag">net-ssh</a><a href="https://rafaelbiriba.com/tag/progress" rel="tag">progress</a><a href="https://rafaelbiriba.com/tag/progresso" rel="tag">progresso</a><a href="https://rafaelbiriba.com/tag/ruby" rel="tag">Ruby</a><a href="https://rafaelbiriba.com/tag/rubygems" rel="tag">rubygems</a><a href="https://rafaelbiriba.com/tag/sftp" rel="tag">sftp</a><a href="https://rafaelbiriba.com/tag/upload" rel="tag">upload</a></span></footer></article><!-- #post-## -->

<article id="post-2271" class="post-2271 post type-post status-publish format-standard hentry category-desenvolvimento category-ruby tag-codigo tag-conexao tag-connection tag-desenvolvimento tag-net-sftp tag-net-ssh tag-ruby tag-rubygems tag-rufus tag-scheduler tag-timeout tag-upload">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/desenvolvimento" rel="category tag">Desenvolvimento</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/ruby" rel="category tag">Ruby</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2010/09/24/problema-no-net-sftp-timeout-para-o-upload.html" rel="bookmark">Net-sftp: Solução para timeout durante o upload</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2010/09/24/problema-no-net-sftp-timeout-para-o-upload.html" rel="bookmark"><time class="entry-date" datetime="2010-09-24T11:15:22+00:00">24/09/2010</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2010/09/24/problema-no-net-sftp-timeout-para-o-upload.html#comments"><span class="dsq-postid" data-dsqidentifier="2271 https://rafaelbiriba.com/?p=2271">5 Comentários</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		
<p style="text-align: justify;"><img class="alignleft size-full wp-image-2273" title="ruby-box" src="https://rafaelbiriba.com/wp-content/uploads/2010/09/ruby-box.png" alt="" width="150" height="150" /></p>
<p style="text-align: justify;">Desenvolvendo um script em ruby para upload de arquivos, utilizando a gem <a title="http://rubygems.org/gems/net-sftp" href="http://rubygems.org/gems/net-sftp" target="_blank">net-sftp</a>, acabei encontrando um problema. A falta de timeout durante a transferência.</p>
<p style="text-align: justify;">Decidi escrever esse post, para compartilhar a minha solução e também receber opniões e outras soluções para o problema. Fiz algo parecido quando escrevi o post sobre o <a title="https://rafaelbiriba.com/2010/08/01/crontab-rodando-um-script-a-cada-15-segundos.html" href="https://rafaelbiriba.com/2010/08/01/crontab-rodando-um-script-a-cada-15-segundos.html" target="_blank">cron de 15 em 15 segundos</a> e obtive resultados bem legais.</p>
<p style="text-align: justify;"><strong>Introdução ao problema<br /></strong>A gem <a title="http://rubygems.org/gems/net-sftp" href="http://rubygems.org/gems/net-sftp" target="_blank">net-sftp</a> é bastante utilizada em scripts ruby que requerem alguma transferência de arquivo utilizando uma conexão segura, como por exemplo, upload, download, criação de diretórios e etc&#8230; Utilizando a gem <a title="http://rubygems.org/gems/net-ssh" href="http://rubygems.org/gems/net-ssh" target="_blank">net-ssh</a> para estabelecer essa conexão.</p>
<p style="text-align: justify;">Primeiramente, vamor ver um exemplo do problema:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
</pre></td><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'rubygems'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'net/sftp'</span>
<span style="color:#6666ff; font-weight:bold;">Net::SFTP</span>.<span style="color:#9900CC;">start</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">'192.168.0.2'</span>, <span style="color:#996600;">'rafaelbiriba'</span>, <span style="color:#006600; font-weight:bold;">&#123;</span>:password <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">'teste'</span>, <span style="color:#ff3333; font-weight:bold;">:timeout</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">3</span><span style="color:#006600; font-weight:bold;">&#125;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>sftp<span style="color:#006600; font-weight:bold;">|</span>
  sftp.<span style="color:#9900CC;">upload</span>!<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;/Users/rafaelbiriba/Projects/temp/video-teste-sftp.mp4&quot;</span>, <span style="color:#996600;">&quot;/home/rafaelbiriba/video-teste-sftp.mp4&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></td></tr></table></div>



<p style="text-align: justify;">O código acima faz o upload de um arquivo de mais de 400 Mb. Se durante o upload houver um problema na sua conexão, o upload fica &#8220;esperando&#8221; a rede voltar, o que é um problemão, pois ele trava a execução do script, sem dar nenhum sinal de vida.</p>
<p style="text-align: justify;">De acordo com a <a title="http://net-ssh.rubyforge.org/sftp/v2/api/classes/Net/SFTP/Session.html#M000115" href="http://net-ssh.rubyforge.org/sftp/v2/api/classes/Net/SFTP/Session.html#M000115" target="_blank">documentação do net-sftp</a>, você pode utilizar o método &#8220;upload&#8221; no lugar de &#8220;upload!&#8221; para não travar a execução do script. Mas ainda sim o problema continua. Fazendo isso, você vai precisar rodar um loop até que o upload termine. Ou seja, se a conexão cair, o método só vai terminar(e sair do loop) quando a conexão voltar. Então essa opção foi logo descartada.</p>
<p style="text-align: justify;">O problema mesmo só acontece quando há perda de conexão depois que a sessão inicia. (O parâmetro :timeout apenas estabelece o limite de espera para iniciar a sessão e não durante a transferência dos arquivos.)</p>
<p style="text-align: justify;">Se o net-sftp / net-ssh aceitasse a opção &#8220;ServerAliveInterval&#8221; (Parametro de configuração do ssh), ele iria verificar a conexão durante a transferência e ao alcançar o limite (&#8220;ServerAliveCountMax&#8221;) seria disparado o timeout. Infelizmente, de acordo com a <a title="http://net-ssh.rubyforge.org/ssh/v2/api/classes/Net/SSH/Config.html" href="http://net-ssh.rubyforge.org/ssh/v2/api/classes/Net/SSH/Config.html" target="_blank">documentação do net-ssh</a> esses parâmetros não estão disponíveis.</p>
<p style="text-align: justify;">Seguindo com a leitura e busca pela solução na <a title="http://net-ssh.rubyforge.org/sftp/v2/api/classes/Net/SFTP/Session.html#M000115" href="http://net-ssh.rubyforge.org/sftp/v2/api/classes/Net/SFTP/Session.html#M000115" target="_blank">documentação do net-sftp</a>, achei uma possível pista para encontrar a solução:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'rubygems'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'net/sftp'</span>
<span style="color:#6666ff; font-weight:bold;">Net::SFTP</span>.<span style="color:#9900CC;">start</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">'192.168.0.2'</span>, <span style="color:#996600;">'rafaelbiriba'</span>, <span style="color:#006600; font-weight:bold;">&#123;</span>:password <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">'teste'</span>, <span style="color:#ff3333; font-weight:bold;">:timeout</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">3</span><span style="color:#006600; font-weight:bold;">&#125;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>sftp<span style="color:#006600; font-weight:bold;">|</span>
  sftp.<span style="color:#9900CC;">upload</span>!<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;/Users/rafaelbiriba/Projects/temp/video-teste-sftp.mp4&quot;</span>, <span style="color:#996600;">&quot;/home/rafaelbiriba/video-teste-sftp.mp4&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>event, uploader, <span style="color:#006600; font-weight:bold;">*</span>args<span style="color:#006600; font-weight:bold;">|</span>
    <span style="color:#9966CC; font-weight:bold;">case</span> event
    <span style="color:#9966CC; font-weight:bold;">when</span> :<span style="color:#CC0066; font-weight:bold;">open</span> <span style="color:#9966CC; font-weight:bold;">then</span>
      <span style="color:#008000; font-style:italic;"># args[0] : file metadata</span>
      <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;starting upload: #{args[0].local} -&gt; #{args[0].remote} (#{args[0].size} bytes}&quot;</span>
    <span style="color:#9966CC; font-weight:bold;">when</span> <span style="color:#ff3333; font-weight:bold;">:put</span> <span style="color:#9966CC; font-weight:bold;">then</span>
      <span style="color:#008000; font-style:italic;"># args[0] : file metadata</span>
      <span style="color:#008000; font-style:italic;"># args[1] : byte offset in remote file</span>
      <span style="color:#008000; font-style:italic;"># args[2] : data being written (as string)</span>
      <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;writing #{args[2].length} bytes to #{args[0].remote} starting at #{args[1]}&quot;</span>
    <span style="color:#9966CC; font-weight:bold;">when</span> <span style="color:#ff3333; font-weight:bold;">:finish</span> <span style="color:#9966CC; font-weight:bold;">then</span>
      <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;all done!&quot;</span>
    <span style="color:#9966CC; font-weight:bold;">end</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></td></tr></table></div>



<p style="text-align: justify;">Acima temos um exemplo simples retirado da <a title="http://net-ssh.rubyforge.org/sftp/v2/api/classes/Net/SFTP/Operations/Upload.html" href="http://net-ssh.rubyforge.org/sftp/v2/api/classes/Net/SFTP/Operations/Upload.html" target="_blank">documentação</a> para o controle do progresso de upload.</p>
<p style="text-align: justify;">Quando o upload inicia, o case recebe o evento &#8220;:open&#8221; onde podemos obter o tamanho total do arquivo e logo em seguida recebe os eventos &#8220;:put&#8221; onde é possível verificar  o quanto (em bytes) do arquivo já foi enviado, possibilitando assim a criação da porcentagem do upload.</p>
<p style="text-align: justify;">Como o foco aqui não é mostrar como obter o progresso (<span style="text-decoration: line-through;">posso mostrar isso exclusivamente em outro post</span> <a title="https://rafaelbiriba.com/2010/11/18/net-sftp-calculando-o-progresso-do-upload.html" href="https://rafaelbiriba.com/2010/11/18/net-sftp-calculando-o-progresso-do-upload.html" target="_blank">calculando o progresso durante o upload</a>), não vou entrar muito em detalhes sobre isso. O que realmente inporta nesses eventos são que durante o upload (:put), ao perder a conexão, nenhum evento é disparado, ou seja, o script não tem como sabe que a conexão caiu e a execução fica travada no upload.</p>
<p style="text-align: justify;"><strong>Minha solução:</strong></p>
<p style="text-align: justify;">Depois de todo esse estudo detalhado sobre o problema, comecei a pensar numa possível solução. Eu precisava utilizar alguma coisa que pudesse verificar e dar timeout no upload caso ele parasse de responder/transferir.</p>
<p style="text-align: justify;">Foi então que <span style="text-decoration: line-through;">pesquisei</span>, testei e implementei o <a title="http://rubygems.org/gems/rufus-scheduler" href="http://rubygems.org/gems/rufus-scheduler" target="_blank">rufus-scheduler</a>*,  um agendador de tarefas que roda dentro do script ruby(mas numa outra thread), onde posso definir um intervalo de execução para executar alguma coisa, como se fosse um cron. ( *Sugestão do <a title="http://twitter.com/vicentemundim" href="http://twitter.com/vicentemundim" target="_blank">@vicentemundim</a> )</p>
<p style="text-align: justify;"><strong>Então a solução foi:</strong> Assim que o upload começar, eu defino um tempo de 10 segundos para ele executar uma tarefa com &#8220;raise exception&#8221;. Então toda vez que o upload responder ao evento (:put), informando que conseguiu subir mais um trecho do arquivo, eu reseto o tempo de execução da tarefa e defino novamente em 10 segundos. Fazendo isso, quando a conexão cair ou o upload travar por algum motivo, ele vai parar de responder ao evento &#8220;:put&#8221;, e então a tarefa agendada para 10 segundos vai disparar o raise, interrompendo a execução do script.</p>
<p style="text-align: justify;">Depois de alguns testes, tanto de desempenho quanto de falhas, percebi que essa resolução serviu perfeitamente. Segue o exemplo do código utilizado:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'rubygems'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'rufus/scheduler'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'net/sftp'</span>
&nbsp;
<span style="color:#0066ff; font-weight:bold;">@job</span> = <span style="color:#0000FF; font-weight:bold;">nil</span>
<span style="color:#0066ff; font-weight:bold;">@scheduler</span> = <span style="color:#6666ff; font-weight:bold;">Rufus::Scheduler::PlainScheduler</span>.<span style="color:#9900CC;">start_new</span>  
<span style="color:#9966CC; font-weight:bold;">def</span> <span style="color:#0066ff; font-weight:bold;">@scheduler</span>.<span style="color:#9900CC;">handle_exception</span> <span style="color:#006600; font-weight:bold;">&#40;</span>job, exception<span style="color:#006600; font-weight:bold;">&#41;</span>
  abort<span style="color:#006600; font-weight:bold;">&#40;</span>exception.<span style="color:#9900CC;">message</span><span style="color:#006600; font-weight:bold;">&#41;</span>
<span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
<span style="color:#9966CC; font-weight:bold;">def</span> job_scheduler
  <span style="color:#0066ff; font-weight:bold;">@job</span>.<span style="color:#9900CC;">unschedule</span> <span style="color:#9966CC; font-weight:bold;">unless</span> <span style="color:#0066ff; font-weight:bold;">@job</span>.<span style="color:#0000FF; font-weight:bold;">nil</span>?
  <span style="color:#0066ff; font-weight:bold;">@job</span> = <span style="color:#0066ff; font-weight:bold;">@scheduler</span>.<span style="color:#9900CC;">every</span> <span style="color:#996600;">&quot;10s&quot;</span> <span style="color:#9966CC; font-weight:bold;">do</span>
    <span style="color:#CC0066; font-weight:bold;">raise</span> <span style="color:#996600;">&quot;SFTP Connection Lost or upload freezed timeout&quot;</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>    
<span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
<span style="color:#6666ff; font-weight:bold;">Net::SFTP</span>.<span style="color:#9900CC;">start</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">'192.168.0.2'</span>, <span style="color:#996600;">'rafaelbiriba'</span>, <span style="color:#006600; font-weight:bold;">&#123;</span>:password <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">'teste'</span>, <span style="color:#ff3333; font-weight:bold;">:timeout</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">3</span><span style="color:#006600; font-weight:bold;">&#125;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>sftp<span style="color:#006600; font-weight:bold;">|</span>
  sftp.<span style="color:#9900CC;">upload</span>!<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;/Users/rafaelbiriba/Projects/temp/video-teste-sftp.mp4&quot;</span>, <span style="color:#996600;">&quot;/home/rafaelbiriba/video-teste-sftp.mp4&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>event, uploader, <span style="color:#006600; font-weight:bold;">*</span>args<span style="color:#006600; font-weight:bold;">|</span>
    <span style="color:#9966CC; font-weight:bold;">case</span> event
    <span style="color:#9966CC; font-weight:bold;">when</span> :<span style="color:#CC0066; font-weight:bold;">open</span> <span style="color:#9966CC; font-weight:bold;">then</span>
      <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;starting upload: #{args[0].local} -&gt; #{args[0].remote} (#{args[0].size} bytes}&quot;</span>
      job_scheduler
    <span style="color:#9966CC; font-weight:bold;">when</span> <span style="color:#ff3333; font-weight:bold;">:put</span> <span style="color:#9966CC; font-weight:bold;">then</span>
      <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;writing #{args[2].length} bytes to #{args[0].remote} starting at #{args[1]}&quot;</span>
      job_scheduler
    <span style="color:#9966CC; font-weight:bold;">when</span> <span style="color:#ff3333; font-weight:bold;">:finish</span> <span style="color:#9966CC; font-weight:bold;">then</span>
      <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&quot;all done!&quot;</span>
     <span style="color:#0066ff; font-weight:bold;">@job</span>.<span style="color:#9900CC;">unschedule</span> <span style="color:#9966CC; font-weight:bold;">unless</span> <span style="color:#0066ff; font-weight:bold;">@job</span>.<span style="color:#0000FF; font-weight:bold;">nil</span>? 
    <span style="color:#9966CC; font-weight:bold;">end</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></td></tr></table></div>



<p style="text-align: justify;">Quando o upload inicia (:open) e durante a transferência (:put), ele chama o método job_scheduler que é responsável por resetar a tarefa anterior(se houver) e agendar uma nova com timeout de 10 segundos.</p>
<p style="text-align: justify;">Conforme expliquei acima, se o upload travar, o tempo limite de 10 segundos é alcançado e uma exceção é disparada.</p>
<p style="text-align: justify;">Como o agendador do rufus roda em outra thread, qualquer exceção disparada é capturada e tratada pelo próprio rufus, fazendo com que a execução do script continue. Então, sobrescrevi o método (handle_exception) e ao receber a exceção, gero um abort que irá interromper todo o script.</p>
<p style="text-align: justify;">Infelizmente, são poucos os sites relacionados sobre esse assunto, o que dificultou bastante a busca e o desenvolvimento. Mesmo assim, acredito ter resolvido o problema com uma solução bem razoável.</p>
<p style="text-align: justify;">Já falei em cima, mas vale ressaltar:<br />&#8220;Decidi escrever esse post, para compartilhar a minha solução e também  receber opniões e outras soluções para o problema. Fiz algo parecido  quando escrevi o post sobre o <a title="https://rafaelbiriba.com/2010/08/01/crontab-rodando-um-script-a-cada-15-segundos.html" href="https://rafaelbiriba.com/2010/08/01/crontab-rodando-um-script-a-cada-15-segundos.html" target="_blank">cron de 15 em 15 segundos</a> e obtive resultados bem legais.&#8221;</p>
<p style="text-align: justify;">Estou pensando em tentar solucionar isso direto no código do net-sftp e quem sabe mandar um patch para o autor. De qualquer forma, fico no aguardo de qualquer comentário e/ou soluções melhores.</p>
<div id="_mcePaste" style="position: absolute; left: -10000px; top: 1775px; width: 1px; height: 1px; overflow: hidden;">


<div class="wp_syntax"><table><tr><td class="code"><pre class="ruby" style="font-family:monospace;">handle_exception</pre></td></tr></table></div>



</div>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_3"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2010/09/24/problema-no-net-sftp-timeout-para-o-upload.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2010/09/24/problema-no-net-sftp-timeout-para-o-upload.html" data-text="Net-sftp: Solução para timeout durante o upload"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F09%2F24%2Fproblema-no-net-sftp-timeout-para-o-upload.html&amp;linkname=Net-sftp%3A%20Solu%C3%A7%C3%A3o%20para%20timeout%20durante%20o%20upload" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F09%2F24%2Fproblema-no-net-sftp-timeout-para-o-upload.html&amp;linkname=Net-sftp%3A%20Solu%C3%A7%C3%A3o%20para%20timeout%20durante%20o%20upload" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/codigo" rel="tag">codigo</a><a href="https://rafaelbiriba.com/tag/conexao" rel="tag">conexão</a><a href="https://rafaelbiriba.com/tag/connection" rel="tag">connection</a><a href="https://rafaelbiriba.com/tag/desenvolvimento" rel="tag">Desenvolvimento</a><a href="https://rafaelbiriba.com/tag/net-sftp" rel="tag">net-sftp</a><a href="https://rafaelbiriba.com/tag/net-ssh" rel="tag">net-ssh</a><a href="https://rafaelbiriba.com/tag/ruby" rel="tag">Ruby</a><a href="https://rafaelbiriba.com/tag/rubygems" rel="tag">rubygems</a><a href="https://rafaelbiriba.com/tag/rufus" rel="tag">rufus</a><a href="https://rafaelbiriba.com/tag/scheduler" rel="tag">scheduler</a><a href="https://rafaelbiriba.com/tag/timeout" rel="tag">timeout</a><a href="https://rafaelbiriba.com/tag/upload" rel="tag">upload</a></span></footer></article><!-- #post-## -->

<article id="post-2030" class="post-2030 post type-post status-publish format-standard hentry category-audio-e-video category-desenvolvimento category-ffmpeg tag-automatizado tag-batch tag-codec tag-converter tag-ffmpeg tag-iphone tag-libfaac tag-libx264 tag-mov tag-mp4 tag-multimedia tag-script tag-video">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/audio-e-video" rel="category tag">Áudio e Vídeo</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento" rel="category tag">Desenvolvimento</a>, <a href="https://rafaelbiriba.com/category/audio-e-video/ffmpeg" rel="category tag">FFmpeg</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2010/03/19/ffmpeg-batch-para-conversao-de-videos-para-iphone-windows.html" rel="bookmark">FFmpeg: Batch para conversão de vídeos para iPhone [Windows]</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2010/03/19/ffmpeg-batch-para-conversao-de-videos-para-iphone-windows.html" rel="bookmark"><time class="entry-date" datetime="2010-03-19T17:37:43+00:00">19/03/2010</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2010/03/19/ffmpeg-batch-para-conversao-de-videos-para-iphone-windows.html#comments"><span class="dsq-postid" data-dsqidentifier="2030 https://rafaelbiriba.com/?p=2030">9 Comentários</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		

<figure id="attachment_28" style="width: 568px" class="wp-caption aligncenter"><a href="https://rafaelbiriba.com/wp-content/uploads/2009/02/ffmpeg-logo.png"><img class="size-full wp-image-28" title="ffmpeg-logo" src="https://rafaelbiriba.com/wp-content/uploads/2009/02/ffmpeg-logo.png" alt="FFmpeg: http://www.ffmpeg.org/" width="568" height="140" srcset="https://rafaelbiriba.com/wp-content/uploads/2009/02/ffmpeg-logo.png 568w, https://rafaelbiriba.com/wp-content/uploads/2009/02/ffmpeg-logo-300x73.png 300w" sizes="(max-width: 568px) 100vw, 568px" /></a><figcaption class="wp-caption-text">FFmpeg: http://www.ffmpeg.org/</figcaption></figure>

<p>Já tem um tempo que estou tentando decidir o que fazer com um computador velho lá de casa. Resolvi instalar Windows nele, e fazer algumas experiências (:D)&#8230; de todo tipo, inclusive instalar servidor de games, VNC, Torrent, e tudo mais&#8230; Configurei meu roteador para deixar esse PC completamente exposto, assim posso brincar também com algumas regras de firewall e fazer o que quiser&#8230;</p>
<p>Como esse meu &#8220;PC cobaia&#8221; está ligado 24h lá em casa, resolvi não desperdiçar seu &#8220;poder de processamento&#8221; e fiz um script em Batch (.bat do windows) para converter vários filmes/vídeos que estou querendo colocar no meu iPhone.</p>
<p>Segue o &#8220;programa&#8221; de enconding para H264:</p>
<p><strong>cd C:\Documents and Settings\Rafael\Desktop\ffmpeg-r16537-gpl-static-win32</strong><strong><br />for %%i in (&#8220;H:\videos\*.rmvb&#8221;) do <br />(<br />ffmpeg -i &#8220;%%i&#8221; -vcodec libx264 -acodec libfaac -deinterlace -sameq &#8220;C:\videos-iphone\%%~ni.mov&#8221;</strong><strong><br />)</strong></p>
<p>Salve todo o código acima num arquivo <strong>.bat</strong> (Pelo bloco de notas mesmo !)<br />Você pode baixar o FFmpeg acessando:  <a title="https://rafaelbiriba.com/ffmpeg-r16537-gpl-static-win32.zip" href="https://rafaelbiriba.com/ffmpeg-r16537-gpl-static-win32.zip" target="_blank">https://rafaelbiriba.com/ffmpeg-r16537-gpl-static-win32.zip</a><br />Leia também: <a title="https://rafaelbiriba.com/2009/02/13/windows-xp-vs-ffmpeg-e-mplayer.html" href="https://rafaelbiriba.com/2009/02/13/windows-xp-vs-ffmpeg-e-mplayer.html" target="_blank">https://rafaelbiriba.com/2009/02/13/windows-xp-vs-ffmpeg-e-mplayer.html</a></p>
<p>Bom, continuando&#8230;<br />O Script pega meus videos com extensão <strong>.rmvb</strong> de dentro da pasta <strong>H:\videos</strong> e salva os novos arquivos na pasta <strong>videos-iphone</strong> que fica na unidade <strong>C:\</strong>.<br />Note que o comando <strong>%%~ni</strong> faz com que o arquivo seja salvo com o mesmo nome do original, só que com a extensão <strong>.mov</strong>.</p>
<p>O profile de encoding para iphone (linha de comando do ffmpeg) que estou utilizando, deixa o video final com a qualidade quase que igual ao vídeo original, o que deixa a codificação bem lenta. Esse script  que tem sido bastante útil pois tenho muitos arquivos de vídeo (muitos mesmo) e quero codifica-los um depois do outro automaticamente (enquanto a máquina não morrer de stress 🙂 ).</p>
<p>Espero que essa informação seja útil para mais alguém&#8230; Provavelmente enquanto estou escrevendo este post, o script está rodando lá em casa 🙂</p>
<p>Abraços a todos 😉</p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_4"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2010/03/19/ffmpeg-batch-para-conversao-de-videos-para-iphone-windows.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2010/03/19/ffmpeg-batch-para-conversao-de-videos-para-iphone-windows.html" data-text="FFmpeg: Batch para conversão de vídeos para iPhone [Windows]"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F03%2F19%2Fffmpeg-batch-para-conversao-de-videos-para-iphone-windows.html&amp;linkname=FFmpeg%3A%20Batch%20para%20convers%C3%A3o%20de%20v%C3%ADdeos%20para%20iPhone%20%5BWindows%5D" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F03%2F19%2Fffmpeg-batch-para-conversao-de-videos-para-iphone-windows.html&amp;linkname=FFmpeg%3A%20Batch%20para%20convers%C3%A3o%20de%20v%C3%ADdeos%20para%20iPhone%20%5BWindows%5D" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/automatizado" rel="tag">automatizado</a><a href="https://rafaelbiriba.com/tag/batch" rel="tag">batch</a><a href="https://rafaelbiriba.com/tag/codec" rel="tag">codec</a><a href="https://rafaelbiriba.com/tag/converter" rel="tag">converter</a><a href="https://rafaelbiriba.com/tag/ffmpeg" rel="tag">FFmpeg</a><a href="https://rafaelbiriba.com/tag/iphone" rel="tag">iphone</a><a href="https://rafaelbiriba.com/tag/libfaac" rel="tag">libfaac</a><a href="https://rafaelbiriba.com/tag/libx264" rel="tag">libx264</a><a href="https://rafaelbiriba.com/tag/mov" rel="tag">mov</a><a href="https://rafaelbiriba.com/tag/mp4" rel="tag">mp4</a><a href="https://rafaelbiriba.com/tag/multimedia" rel="tag">multimedia</a><a href="https://rafaelbiriba.com/tag/script" rel="tag">script</a><a href="https://rafaelbiriba.com/tag/video" rel="tag">video</a></span></footer></article><!-- #post-## -->

<article id="post-1900" class="post-1900 post type-post status-publish format-standard hentry category-ruby tag-cloud tag-cloudcrowd tag-crowd tag-gem tag-json tag-parallel-encoding tag-ruby tag-rubygems">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/desenvolvimento/ruby" rel="category tag">Ruby</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2010/02/08/cloud-crowd-a-primeira-action.html" rel="bookmark">Cloud Crowd: A primeira action</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2010/02/08/cloud-crowd-a-primeira-action.html" rel="bookmark"><time class="entry-date" datetime="2010-02-08T13:40:27+00:00">08/02/2010</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2010/02/08/cloud-crowd-a-primeira-action.html#respond"><span class="dsq-postid" data-dsqidentifier="1900 https://rafaelbiriba.com/?p=1900">Deixe um comentário</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		
<p><img class="size-full wp-image-1901 alignleft" title="cloud-crowd" src="https://rafaelbiriba.com/wp-content/uploads/2010/01/cloud-crowd.png" alt="cloud-crowd" width="236" height="91" /><a title="http://wiki.github.com/documentcloud/cloud-crowd/" href="http://wiki.github.com/documentcloud/cloud-crowd/" target="_blank"></a></p>
<p style="text-align: justify;"><a title="http://wiki.github.com/documentcloud/cloud-crowd/" href="http://wiki.github.com/documentcloud/cloud-crowd/" target="_blank">Cloud Crowd</a> é um controlador de filas para processamento paralelo, desenvolvido em ruby. Pode ser utilizado em Encoding de video, migração de arquivos e bancos de dados, redimensionamento de imagens e etc&#8230;</p>
<p style="text-align: justify;">Uma explicação rápida: Em uma máquina você levanta o <span style="color: #ff0000;">server</span>, onde é gerenciado a fila (criação, exclusão, status das tarefas e etc&#8230;). Em outras máquinas você levanta o <span style="color: #ff0000;">node</span>, onde as terefas serão recebidas e executadas. Ao terminar, o node informa ao server, liberando-se para receber outra tarefa.</p>
<p style="text-align: justify;">Essa semana comecei a desvendar os benefícios do Cloud Crowd, principalmente para encoding paralelo de vídeo. Mas antes, tive que entender como ele funciona e o que tem para nos oferecer.</p>
<p style="text-align: justify;">Então, acompanhando o &#8220;tutorial&#8221; em <a title="http://wiki.github.com/documentcloud/cloud-crowd/writing-an-action" href="http://wiki.github.com/documentcloud/cloud-crowd/writing-an-action" target="_blank">http://wiki.github.com/documentcloud/cloud-crowd/writing-an-action</a>, escrevi uma pequena action:</p>


<div class="wp_syntax"><table><tr><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#9966CC; font-weight:bold;">class</span> HelloWorld <span style="color:#006600; font-weight:bold;">&lt;</span> <span style="color:#6666ff; font-weight:bold;">CloudCrowd::Action</span>
   <span style="color:#9966CC; font-weight:bold;">def</span> process
      <span style="color:#6666ff; font-weight:bold;">Thin::Logging</span>.<span style="color:#9900CC;">log</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;HelloWorld :: -- criando arquivo #{input}!&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
      <span style="color:#996600;">`touch #{input}`</span>
      <span style="color:#006666;">0</span>
   <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></td></tr></table></div>



<p style="text-align: justify;">Você passa um nome qualquer, e o script cria um arquivo em branco. Simples !?, Mas serviu bem para meus primeiros testes.</p>
<p style="text-align: justify;">Também aproveitei e usei o log do <strong>Thin</strong> que é o servidor que o Cloud Crowd levanta, para registrar o evento de dentro da action&#8230; Isso significa que as mensagens de log da minha action foram registradas no arquivo de log do node que a executou&#8230; Se preferir você pode utilizar o Logger do Rails. Como foi apenas um experimento, utilizei o do Thin mesmo.</p>
<p style="text-align: justify;"><strong>Cadastrando tarefas:</strong></p>
<p style="text-align: justify;">Para começar a utilizar sua action,  você precisa postar um JSON com as informações necessárias no server, para cadastrar uma tarefa. (Não preciso lembrar que o server e algum node deve estar rodando, certo ?)</p>
<p>Para isso, crie um script ruby, ou rode pelo irb os comandos*:</p>


<div class="wp_syntax"><table><tr><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'rubygems'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'restclient'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'json'</span>
RestClient.<span style="color:#9900CC;">post</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">'http://localhost:9173/jobs'</span>,<span style="color:#006600; font-weight:bold;">&#123;</span>:job <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">'action'</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">'hello_world'</span> , <span style="color:#996600;">'inputs'</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">'/home/rafael/arquivo_teste1'</span>, <span style="color:#996600;">'/home/rafael/arquivo_teste2'</span><span style="color:#006600; font-weight:bold;">&#93;</span><span style="color:#006600; font-weight:bold;">&#125;</span>.<span style="color:#9900CC;">to_json</span><span style="color:#006600; font-weight:bold;">&#125;</span><span style="color:#006600; font-weight:bold;">&#41;</span></pre></td></tr></table></div>



<p style="text-align: justify;">Considerando que o server está rodando na máquina que rodou o script. Caso contrário, altere o localhost pelo ip do Server. E os arquivos são criados (pelo comando &#8220;touch&#8221;) na máquina que roda o Node. Para fins de teste e desenvolvimento, é possível rodar o server e o node na mesma máquina, já que eles sobem em portas diferentes&#8230;</p>
<p style="text-align: justify;">Então é isso&#8230; Você já pode paralelizar qualquer tarefa. Basta escrever suas próprias actions&#8230; 😉</p>
<p>&nbsp;</p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_5"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2010/02/08/cloud-crowd-a-primeira-action.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2010/02/08/cloud-crowd-a-primeira-action.html" data-text="Cloud Crowd: A primeira action"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F02%2F08%2Fcloud-crowd-a-primeira-action.html&amp;linkname=Cloud%20Crowd%3A%20A%20primeira%20action" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2010%2F02%2F08%2Fcloud-crowd-a-primeira-action.html&amp;linkname=Cloud%20Crowd%3A%20A%20primeira%20action" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/cloud" rel="tag">cloud</a><a href="https://rafaelbiriba.com/tag/cloudcrowd" rel="tag">cloudcrowd</a><a href="https://rafaelbiriba.com/tag/crowd" rel="tag">crowd</a><a href="https://rafaelbiriba.com/tag/gem" rel="tag">gem</a><a href="https://rafaelbiriba.com/tag/json" rel="tag">json</a><a href="https://rafaelbiriba.com/tag/parallel-encoding" rel="tag">parallel encoding</a><a href="https://rafaelbiriba.com/tag/ruby" rel="tag">Ruby</a><a href="https://rafaelbiriba.com/tag/rubygems" rel="tag">rubygems</a></span></footer></article><!-- #post-## -->

<article id="post-1810" class="post-1810 post type-post status-publish format-standard hentry category-desenvolvimento category-javascript category-php tag-alert tag-ano-novo tag-codigo tag-javascript tag-natal tag-php tag-script">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/desenvolvimento" rel="category tag">Desenvolvimento</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/javascript" rel="category tag">Javascript</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/php" rel="category tag">PHP</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2009/12/24/feliz-ano-novo-com-javascript.html" rel="bookmark">Feliz ano novo com javascript !</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2009/12/24/feliz-ano-novo-com-javascript.html" rel="bookmark"><time class="entry-date" datetime="2009-12-24T18:47:49+00:00">24/12/2009</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2009/12/24/feliz-ano-novo-com-javascript.html#comments"><span class="dsq-postid" data-dsqidentifier="1810 https://rafaelbiriba.com/?p=1810">3 Comentários</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		
<p style="text-align: justify;"><img class="size-full wp-image-1817 alignleft" title="natal-16" src="https://rafaelbiriba.com/wp-content/uploads/2009/12/natal-16.jpg" alt="natal-16" width="233" height="350" srcset="https://rafaelbiriba.com/wp-content/uploads/2009/12/natal-16.jpg 233w, https://rafaelbiriba.com/wp-content/uploads/2009/12/natal-16-199x300.jpg 199w" sizes="(max-width: 233px) 100vw, 233px" />Primeiramente, gostaria de desejar a <strong>todos os leitores e amigos</strong> que acompanham meu blog:</p>
<h3 style="text-align: justify;"><span style="color: #ff0000;"><strong>Um feliz natal e um próspero ano novo !</strong></span><br /></h3>
<p style="text-align: justify;">Entrando nesse ritmo de natal e ano novo, desenvolvi um pequeno código em javascript para desejar feliz natal e ano novo para os leitores do meu blog.</p>
<p style="text-align: justify;">O código está realmente simples, e pode ser alterado e utilizado aonde quiser&#8230; Só não esqueça de deixar sua opnião nos comentários abaixo!</p>
<p style="text-align: justify;"><strong>O script funciona da seguinte maneira:</strong><br />3 variáveis são definidas no inicio: <br />Data atual (<span style="color: #ff0000;">var agora</span>).<br />Data do ano novo (<span style="color: #ff0000;">var anoNovo</span>).<br />Data máxima de exibição (<span style="color: #ff0000;">var anoNovoMax</span>).</p>
<p style="text-align: justify;">O alert com a mensagem será exibida enquanto a data atual estiver dentro do intervalo das outras 2 datas.</p>
<p style="text-align: justify;">Abaixo segue o código:</p>


<div class="wp_syntax"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #339933;">&lt;</span>script language<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;JavaScript&quot;</span><span style="color: #339933;">&gt;</span>
<span style="color: #000066; font-weight: bold;">var</span> agora <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> <span style="">Date</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000066; font-weight: bold;">var</span> anoNovo <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> <span style="">Date</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">2010</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000066; font-weight: bold;">var</span> anoNovoMax <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> <span style="">Date</span><span style="color: #009900;">&#40;</span><span style="color: #CC0000;">2010</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">1</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">23</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">59</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">59</span><span style="color: #339933;">,</span> <span style="color: #CC0000;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000066; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span>agora <span style="color: #339933;">&gt;=</span> anoNovo <span style="color: #339933;">&amp;&amp;</span> agora<span style="color: #339933;">&lt;</span>anoNovoMax<span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#123;</span>
alert<span style="color: #009900;">&#40;</span><span style="color: #3366CC;">&quot;Feliz ano novo !&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
<span style="color: #339933;">&lt;/</span>script<span style="color: #339933;">&gt;</span></pre></td></tr></table></div>



<p style="text-align: justify;"><strong>Para implementar no wordpress, é bem simples:</strong><br />Adicione um Widget de texto em seu wordpress, e sem atribuir um titulo, insira o codigo javascript diretamente no campo de baixo &#8220;descrição&#8221;. Fazendo isso, o widget não ficará visível, mas o código vai funcionar&#8230; 🙂</p>
<p style="text-align: justify;"><strong>Para implementar em seu site:</strong><br />Basta inserir o javascript em sua página.</p>
<p style="text-align: justify;"><span style="color: #ff0000;"><strong>Dica:</strong></span><br />Como o javascript pega a data da máquina do cliente, você corre o risco de pegar a data errada.  Uma solução seria usar o PHP para definir a data, ou seja,  seria a data atual seu servidor. Exemplo:</p>


<div class="wp_syntax"><table><tr><td class="code"><pre class="php" style="font-family:monospace;">var agora = new Date(<span style="color: #000000; font-weight: bold;">&lt;?php</span> <span style="color: #b1b100;">echo</span> <span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Y, m, d, H, i, s&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">?&gt;</span>);</pre></td></tr></table></div>



<p style="text-align: justify;"><strong>Então é isso&#8230; Façam bom proveito !</strong></p>
<p style="text-align: justify;">Aqui no blog, já está implementado as mensagens de Feliz Natal e Feliz Ano Novo&#8230; Serão exibidas durante todo o dia 25 e 01, respectivamente ! <strong>Visitem o Blog e confiram !</strong> 😉</p>
<p>&nbsp;</p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_6"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2009/12/24/feliz-ano-novo-com-javascript.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2009/12/24/feliz-ano-novo-com-javascript.html" data-text="Feliz ano novo com javascript !"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F12%2F24%2Ffeliz-ano-novo-com-javascript.html&amp;linkname=Feliz%20ano%20novo%20com%20javascript%20%21" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F12%2F24%2Ffeliz-ano-novo-com-javascript.html&amp;linkname=Feliz%20ano%20novo%20com%20javascript%20%21" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/alert" rel="tag">alert</a><a href="https://rafaelbiriba.com/tag/ano-novo" rel="tag">ano novo</a><a href="https://rafaelbiriba.com/tag/codigo" rel="tag">codigo</a><a href="https://rafaelbiriba.com/tag/javascript" rel="tag">Javascript</a><a href="https://rafaelbiriba.com/tag/natal" rel="tag">natal</a><a href="https://rafaelbiriba.com/tag/php" rel="tag">PHP</a><a href="https://rafaelbiriba.com/tag/script" rel="tag">script</a></span></footer></article><!-- #post-## -->

<article id="post-791" class="post-791 post type-post status-publish format-standard hentry category-desenvolvimento category-php tag-codigo tag-historico tag-log tag-logger tag-php tag-registro">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/desenvolvimento" rel="category tag">Desenvolvimento</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/php" rel="category tag">PHP</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2009/07/02/php-arquivo-de-log-personalizado.html" rel="bookmark">PHP: Arquivo de log personalizado</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2009/07/02/php-arquivo-de-log-personalizado.html" rel="bookmark"><time class="entry-date" datetime="2009-07-02T23:08:38+00:00">02/07/2009</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2009/07/02/php-arquivo-de-log-personalizado.html#comments"><span class="dsq-postid" data-dsqidentifier="791 https://rafaelbiriba.com/?p=791">33 Comentários</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		
<p>&nbsp;</p>

<figure id="attachment_186" style="width: 232px" class="wp-caption alignleft"><img class="size-full wp-image-186" title="php-logo-sombra" src="https://rafaelbiriba.com/wp-content/uploads/2009/02/php-logo-sombra.jpg" alt="PHP: http://www.php.net/" width="232" height="196" /><figcaption class="wp-caption-text">PHP: http://www.php.net/</figcaption></figure>
<p style="text-align: justify;">Semana passada, estive fazendo num pequeno site, uma área de login. Foi então que fiz uma funçãozinha no PHP que gera logs diários dos eventos ocorridos desde o login até o logoff, como por exemplo, ações tomadas pelos usuários na parte administrativa.</p>
<p style="text-align: justify;">Abaixo, vocês poderão conferir o código que utilizei, logicamente adaptado para que fosse publicado aqui.</p>
<p style="text-align: justify;">Os arquivos de log são gerados baseado no dia em que se encontra. Como os arquivos estão em formato <strong>.txt</strong>, utilizei um prefixo no arquivo, para que o acesso não seja tão óbvio por pessoas desautorizadas.</p>
<p style="text-align: justify;">A função armazena no arquivo a hora da ocorrência, seguido pelo IP da máquina do cliente e a mensagem definida por você.</p>
<p style="text-align: justify;">Vamos então seguir para o código:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
&nbsp;
<span style="color: #990000;">date_default_timezone_set</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'America/Sao_Paulo'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> Logger<span style="color: #009900;">&#40;</span><span style="color: #000088;">$msg</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
&nbsp;
<span style="color: #000088;">$data</span> <span style="color: #339933;">=</span> <span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;d-m-y&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$hora</span> <span style="color: #339933;">=</span> <span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;H:i:s&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$ip</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$_SERVER</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REMOTE_ADDR'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//Nome do arquivo:</span>
<span style="color: #000088;">$arquivo</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Logger_<span style="color: #006699; font-weight: bold;">$data</span>.txt&quot;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//Texto a ser impresso no log:</span>
<span style="color: #000088;">$texto</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;[<span style="color: #006699; font-weight: bold;">$hora</span>][<span style="color: #006699; font-weight: bold;">$ip</span>]&gt; <span style="color: #006699; font-weight: bold;">$msg</span> <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000088;">$manipular</span> <span style="color: #339933;">=</span> <span style="color: #990000;">fopen</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$arquivo</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;a+b&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #990000;">fwrite</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$manipular</span><span style="color: #339933;">,</span> <span style="color: #000088;">$texto</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #990000;">fclose</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$manipular</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table></div>



<p>Salve o arquivo acima como <strong>logger.php</strong></p>
<p>Na linha <strong>3</strong><strong> </strong> estou declarando o timezone para São Paulo, mesmo estando no Rio de Janeiro, o horário é o mesmo. Isso serve para configurar a data para minha localidade, já que no meu caso, o servidor se encontra em outro fuso horário.</p>
<p>Nas linhas <strong>7</strong>, <strong>8</strong> e <strong>9</strong> estou declarando as variáveis de data, hora e ip da máquina que gerou o log (cliente).</p>
<p>Na linha <strong>12</strong> está o nome do arquivo. Será algo do tipo <span style="color: #ff0000;">Logger_19-06-2009.txt</span> (dia-mês-ano). Caso deseje armazenar o log em uma pasta já existente, altere a linha para:<span style="color: #000000;"> <strong><br />$arquivo = &#8220;<span style="color: #ff0000;">minhapasta/</span>Logger_$data.txt&#8221;;</strong></span></p>
<p>Na linha <strong>17</strong> está a função de abertura do arquivo.  Passando o &#8220;a+&#8221; como parâmetro, apenas nos dias que tiver alguma coisa para ser inserida no log, é que o arquivo será criado ou se já existir, escreverá o registro no fim do arquivo. O parâmetro &#8220;b&#8221; serve para questões de portabilidade ( inserção recomendado no manual do php )</p>
<p>As linhas <strong>18</strong> e <strong>19</strong> manipulam e fecham o arquivo definido na linha 12.</p>
<p>Agora vamos para o código onde vamos utilizar nossa função:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
&nbsp;
<span style="color: #b1b100;">include</span> <span style="color: #0000ff;">&quot;logger.php&quot;</span><span style="color: #339933;">;</span>
&nbsp;
Logger<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Testando a função logger !&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Logger<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Como você pode ver, estou logando uma informação !&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
Logger<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;Teste 1, Teste 2, Teste 3!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table></div>



<p>Salve o arquivo acima como <strong>teste.php</strong> na mesma página onde se encontra o <span style="color: #ff0000;">logger.php</span>.</p>
<p>Pronto. O Script acima gera 3 saídas consecutivas no seu arquivo de log.<br />Conferindo o resultado: <br />Nome do arquivo gerado:<span style="color: #ff0000;"><br />Logger_19-06-09.txt</span><br />Conteúdo: <br /><span style="color: #ff0000;">[21:57:36][201.7.xxx.xxx]&gt; Testando a função logger ! <br />[21:57:36][201.7.xxx.xxx]&gt; Como você pode ver, estou logando uma informação ! <br />[21:57:36][201.7.xxx.xxx]&gt; Teste 1, Teste 2, Teste 3! </span></p>
<p>Bom, espero que o script sirva para mais alguém. 🙂</p>
<p><strong>===========================================</strong></p>
<p style="text-align: justify;"><strong>Atualização em 13/abril/2011</strong></p>
<p style="text-align: justify;">A leitora Renata nos comentários de hoje (13/04/11) deixou uma dúvida muito boa&#8230; Vale a pena editar a matéria e acrescentar a solução dela aqui&#8230;</p>
<p style="text-align: justify;">Ela estava encontrando problemas para centralizar os arquivos de log em um só lugar. Ela trabalhava com pastas para organizar seus arquivos, e ao incluir a função logger nos arquivos, fazia com que os logs fossem gravados separadamente em cada pasta.</p>
<p style="text-align: justify;"><strong>Por que isso ocorreu ? </strong></p>
<p style="text-align: justify;">Ela estava incluindo a função da maneira correta: <strong><span style="color: #ff0000;">include &#8220;../logger.php&#8221;;</span></strong> mas o problema estava mesmo dentro da função Logger.</p>
<p style="text-align: justify;">Na variável $arquivo, onde definimos o nome do arquivo de log, a função parte do princípio que o arquivo .txt está do lado do arquivo .php que contém a função&#8230;</p>
<p style="text-align: justify;">Consideremos o seguinte path de diretórios:</p>
<p style="text-align: justify;">/<br />/logs/Logger.txt<br />/logger.php<br />/folder1/pagina1.php</p>
<p style="text-align: justify;">Ao incluir a função logger de dentro da &#8220;pagina1&#8221;, chamando a função como a Renata fez (&#8220;../logger.php&#8221;), faz com que ao definir a variavel $arquivo = &#8220;teste.txt&#8221; o PHP vai salvar o arquivo dentro da pasta &#8220;folder1&#8221; pois ele interpreta o codigo a partir daquele contexto.</p>
<p style="text-align: justify;">Para resolver isso, ao entrar na função Logger, voce precisa mudar o contexto da execução para ele salvar o log corretamente na pasta log (independente de onde ela estiver), e no final da função, você precisa voltar o contexto para onde ele estava, para evitar possiveis problemas.</p>
<p style="text-align: justify;">Segue então o novo código que resolve o problema:</p>


<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
&nbsp;
<span style="color: #990000;">date_default_timezone_set</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'America/Sao_Paulo'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> Logger<span style="color: #009900;">&#40;</span><span style="color: #000088;">$msg</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//pega o path completo de onde esta executanto</span>
<span style="color: #000088;">$caminho_atual</span> <span style="color: #339933;">=</span> <span style="color: #990000;">getcwd</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
<span style="color: #666666; font-style: italic;">//muda o contexto de execução para a pasta logs</span>
<span style="color: #990000;">chdir</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;/home/rafaelbiriba/public_html/logs&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000088;">$data</span> <span style="color: #339933;">=</span> <span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;d-m-y&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$hora</span> <span style="color: #339933;">=</span> <span style="color: #990000;">date</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;H:i:s&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$ip</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$_SERVER</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'REMOTE_ADDR'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//Nome do arquivo:</span>
<span style="color: #000088;">$arquivo</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;Logger_<span style="color: #006699; font-weight: bold;">$data</span>.txt&quot;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//Texto a ser impresso no log:</span>
<span style="color: #000088;">$texto</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;[<span style="color: #006699; font-weight: bold;">$hora</span>][<span style="color: #006699; font-weight: bold;">$ip</span>]&gt; <span style="color: #006699; font-weight: bold;">$msg</span> <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000088;">$manipular</span> <span style="color: #339933;">=</span> <span style="color: #990000;">fopen</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$arquivo</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;a+b&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #990000;">fwrite</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$manipular</span><span style="color: #339933;">,</span> <span style="color: #000088;">$texto</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #990000;">fclose</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$manipular</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//Volta o contexto de execução para o caminho em que estava antes</span>
<span style="color: #990000;">chdir</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$caminho_atual</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table></div>



<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_7"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2009/07/02/php-arquivo-de-log-personalizado.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2009/07/02/php-arquivo-de-log-personalizado.html" data-text="PHP: Arquivo de log personalizado"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F07%2F02%2Fphp-arquivo-de-log-personalizado.html&amp;linkname=PHP%3A%20Arquivo%20de%20log%20personalizado" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F07%2F02%2Fphp-arquivo-de-log-personalizado.html&amp;linkname=PHP%3A%20Arquivo%20de%20log%20personalizado" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/codigo" rel="tag">codigo</a><a href="https://rafaelbiriba.com/tag/historico" rel="tag">historico</a><a href="https://rafaelbiriba.com/tag/log" rel="tag">log</a><a href="https://rafaelbiriba.com/tag/logger" rel="tag">logger</a><a href="https://rafaelbiriba.com/tag/php" rel="tag">PHP</a><a href="https://rafaelbiriba.com/tag/registro" rel="tag">registro</a></span></footer></article><!-- #post-## -->

<article id="post-549" class="post-549 post type-post status-publish format-standard hentry category-desenvolvimento category-google-chart-api category-qr-code category-tecnologia tag-armazenamento tag-codificacao tag-codigo tag-codigo-de-barras tag-decifrar tag-kaywa tag-leitura tag-qr tag-qr-code tag-scanner tag-tecnologia">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/desenvolvimento" rel="category tag">Desenvolvimento</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/google-chart-api" rel="category tag">Google Chart API</a>, <a href="https://rafaelbiriba.com/category/tecnologia/qr-code" rel="category tag">QR Code</a>, <a href="https://rafaelbiriba.com/category/tecnologia" rel="category tag">Tecnologia</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2009/05/02/qr-code-gere-com-o-google-chart-api.html" rel="bookmark">QR Code: Gere com o Google Chart API</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2009/05/02/qr-code-gere-com-o-google-chart-api.html" rel="bookmark"><time class="entry-date" datetime="2009-05-02T09:30:28+00:00">02/05/2009</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2009/05/02/qr-code-gere-com-o-google-chart-api.html#comments"><span class="dsq-postid" data-dsqidentifier="549 https://rafaelbiriba.com/?p=549">2 Comentários</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		
<p><img class="alignleft" title="QR Code com a URL deste BLOG" src="https://chart.apis.google.com/chart?chs=150x150&amp;cht=qr&amp;chl=https://rafaelbiriba.com&amp;choe=UTF-8" alt="" /></p>
<p style="text-align: justify;">Devido à rápida difusão e com vários sites e revistas dando ênfase a esse assunto, na semana passada tive mais de 100 visitas vindas diretamente de buscas sobre Qr code pelo Google.</p>
<p style="text-align: justify;">Então resolvi continuar postando, e dessa vez, como gerar utilizando a ferramenta Chart API do Google.<br />Você que ainda não conhece esta tecnologia, pode ler mais em: <a title="https://rafaelbiriba.com/category/tecnologia/qr-code" href="https://rafaelbiriba.com/category/tecnologia/qr-code" target="_blank">https://rafaelbiriba.com/category/tecnologia/qr-code</a></p>
<p style="text-align: justify;">A imagem ao lado está sendo gerada pela seguinte URL: ( dividida para uma melhor visualização )</p>
<p style="text-align: justify;">http://chart.apis.google.com/chart?<br />&amp;chs=<strong>150&#215;150</strong><br />&amp;cht=qr<br />&amp;chl=<strong>https://rafaelbiriba.com</strong><br />&amp;choe=<strong>UTF-8</strong></p>
<p style="text-align: justify;">Recomendo que apenas os valores em negrito/colorido sejam editados para facilitar a exibição. Qualquer alteração nos outros parâmetros, recomendo ler a documentação em <a title="http://code.google.com/intl/pt-BR/apis/chart/#qrcodes" href="http://code.google.com/intl/pt-BR/apis/chart/#qrcodes" target="_blank">http://code.google.com/intl/pt-BR/apis/chart/#qrcodes</a>.</p>
<p style="text-align: justify;"><a title="http://chart.apis.google.com/chart?chs=150x150&amp;cht=qr&amp;chl=https://rafaelbiriba.com&amp;choe=UTF-8" href="http://chart.apis.google.com/chart?chs=150x150&amp;cht=qr&amp;chl=https://rafaelbiriba.com&amp;choe=UTF-8" target="_blank">Clique aqui para acessar o link completo do gráfico.</a></p>
<p style="text-align: justify;"><strong><span style="color: #ff0000;">&amp;chs = </span></strong><span style="color: #000000;">Dimensões em pixel. De acordo com a documentação do google, a maior dimensão deve ter no máximo 300000 pixel, como por exemplo: 600&#215;500, 300&#215;1000, etc&#8230;<br /></span></p>
<p style="text-align: justify;"><strong><span style="color: #ff0000;">&amp;cht = </span></strong><span style="color: #000000;">Tipo do gráfico. Neste caso <strong>qr</strong></span></p>
<p style="text-align: justify;"><strong><span style="color: #ff0000;">&amp;chl = </span></strong><span style="color: #000000;">Conteúdo à ser codificado, lembrando que quanto maior o conteúdo, mais linhas e colunas a imagem vai ter, aumentando o seu tamanho, automaticamente.</span></p>
<p style="text-align: justify;"><strong><span style="color: #ff0000;">&amp;choe = </span></strong><span style="color: #000000;">Especifica opcionalmente como será a saída codificada. As opções mais comuns são UTF-8 e ISO-8859-1</span></p>
<p style="text-align: justify;">Antes de gerar o código QR, considere o tipo de dispositivo a ser usado para a leitura do código. Os melhores leitores de código QR conseguem ler códigos versão 40, dispositivos móveis podem ler somente até a versão 4.</p>
<p style="text-align: justify;">O Google recomenda manter a versão 4, que equivale a cerca de 100 caracteres alfanuméricos no nível de EC padrão.<strong><br /></strong></p>
<p style="text-align: justify;"><strong>Linhas e Colunas de um QR code:</strong></p>
<ul style="text-align: justify;">
	<li> A versão 1 tem 21 linhas e colunas e pode codificar até 25 caracteres alfanuméricos ( EC = L )</li>
	<li> A versão 2 tem 25 linhas e colunas e pode codificar até 47 caracteres alfanuméricos ( EC = L )</li>
	<li>A versão 3 tem 29 linhas e colunas e pode codificar até 77 caracteres alfanuméricos ( EC = L )</li>
	<li>A versão 4 tem 33 linhas e colunas e pode codificar até 114 caracteres alfanuméricos ( EC = L )</li>
	<li>&#8230;</li>
	<li>A versão 40 tem 177 linhas e colunas e pode codificar até 4,296 caracteres alfanuméricos ( EC = L )</li>
</ul>
<p style="text-align: justify;"><span style="color: #000000;"><strong>Parâmetro opcional: </strong>Correção de erros: ( <strong>EC </strong>)<br /></span></p>
<p style="text-align: justify;"><strong><span style="color: #ff0000;">&amp;chld = </span></strong><span style="color: #000000;">Adicionando esse parâmetro no final da URL para gerar o QR Code, você pode especificar o tipo de correção de erros. Abaixo segue cada uma das opções disponíveis:<br /><br /></span>&#8211; <strong>L</strong> permite que 7% de um código QR seja restaurado<br /> &#8211; <strong>M </strong>permite que 15% de um código QR seja restaurado<br /> &#8211; <strong>Q</strong> permite que 25% de um código QR seja restaurado<br /> &#8211; <strong>H</strong> permite que 30% de um código QR seja restaurado</p>
<p style="text-align: justify;"><a title="http://chart.apis.google.com/chart?chs=150x150&amp;cht=qr&amp;chl=https://rafaelbiriba.com&amp;choe=UTF-8&amp;chld=H" href="http://chart.apis.google.com/chart?chs=150x150&amp;cht=qr&amp;chl=https://rafaelbiriba.com&amp;choe=UTF-8&amp;chld=H" target="_blank">Clique aqui para acessar o link completo do gráfico com o parâmetro de correção de erros ( EC = H ).</a></p>
<p style="text-align: justify;">Acessando o link: <a title="http://code.google.com/intl/pt-BR/apis/chart/#ec_level_table" href="http://code.google.com/intl/pt-BR/apis/chart/#ec_level_table" target="_blank">http://code.google.com/intl/pt-BR/apis/chart/#ec_level_table</a>, é possível analisar a tabela com informações de quantos caracteres podem ser armazenados em cada versão da imagem e com cada um dos nível de correção.</p>
<p style="text-align: justify;">🙂</p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_8"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2009/05/02/qr-code-gere-com-o-google-chart-api.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2009/05/02/qr-code-gere-com-o-google-chart-api.html" data-text="QR Code: Gere com o Google Chart API"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F05%2F02%2Fqr-code-gere-com-o-google-chart-api.html&amp;linkname=QR%20Code%3A%20Gere%20com%20o%20Google%20Chart%20API" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F05%2F02%2Fqr-code-gere-com-o-google-chart-api.html&amp;linkname=QR%20Code%3A%20Gere%20com%20o%20Google%20Chart%20API" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/armazenamento" rel="tag">armazenamento</a><a href="https://rafaelbiriba.com/tag/codificacao" rel="tag">codificação</a><a href="https://rafaelbiriba.com/tag/codigo" rel="tag">codigo</a><a href="https://rafaelbiriba.com/tag/codigo-de-barras" rel="tag">código de barras</a><a href="https://rafaelbiriba.com/tag/decifrar" rel="tag">decifrar</a><a href="https://rafaelbiriba.com/tag/kaywa" rel="tag">kaywa</a><a href="https://rafaelbiriba.com/tag/leitura" rel="tag">leitura</a><a href="https://rafaelbiriba.com/tag/qr" rel="tag">QR</a><a href="https://rafaelbiriba.com/tag/qr-code" rel="tag">QR Code</a><a href="https://rafaelbiriba.com/tag/scanner" rel="tag">scanner</a><a href="https://rafaelbiriba.com/tag/tecnologia" rel="tag">Tecnologia</a></span></footer></article><!-- #post-## -->

<article id="post-489" class="post-489 post type-post status-publish format-standard hentry category-desenvolvimento category-ruby tag-codigo tag-desenvolvimento tag-hpricot tag-programacao tag-ruby tag-ruby-on-rails tag-rubygems tag-rubyonrails tag-web">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/desenvolvimento" rel="category tag">Desenvolvimento</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/ruby" rel="category tag">Ruby</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2009/04/29/ruby-require-rubygems-alternativas.html" rel="bookmark">Ruby: Alternativas para require &#8216;rubygems&#8217;</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2009/04/29/ruby-require-rubygems-alternativas.html" rel="bookmark"><time class="entry-date" datetime="2009-04-29T09:00:39+00:00">29/04/2009</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2009/04/29/ruby-require-rubygems-alternativas.html#comments"><span class="dsq-postid" data-dsqidentifier="489 https://rafaelbiriba.com/?p=489">2 Comentários</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		
<p><img class="size-full wp-image-408 alignleft" title="ruby-logo-justruby" src="https://rafaelbiriba.com/wp-content/uploads/2009/04/ruby-logo-justruby.jpg" alt="ruby-logo-justruby" width="132" height="150" /></p>
<p style="text-align: justify;">Baseado no comentário <span class="info">de <a id="commentauthor-26" title="http://gc.blog.br/" href="http://gc.blog.br/">Guilherme Chapiewski</a></span> encontrado em <a title="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html#comments" href="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html#comments" target="_blank">https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html</a>, resolvi postar alternativas para suprir essa necessidade do require &#8216;rubygems&#8217; e porque é errado utilizá-lo !</p>
<p style="text-align: justify;">Primeiramente, vamos para a pergunta que originou este post:<br /><strong>O que há de errado em utilizar <span style="color: #ff0000;">require &#8216;rubygems&#8217;</span> no meu script ?</strong></p>
<p style="text-align: justify;">Bom, analisando o exemplo que eu dei no <a title="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html#comments" href="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html#comments" target="_blank">post do require rubygems</a>, transcrito logo abaixo, onde se você quiser utilizar o <span style="color: #ff0000;">pacote &#8220;hpricot&#8221;</span>, instalado pelo comando <strong>gem install hpricot,</strong> o código não irá rodar, retornando um erro referente ao rubygems. Usando o <span style="color: #ff0000;">require &#8216;rubygems&#8217; </span>o problema é resolvido, mas não está correto. O motivo é bem simples. Primeiro vamos ver o código em questão:</p>


<div class="wp_syntax"><table><tr><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'hpricot'</span> 
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'open-uri'</span> 
meuXml = Hpricot.<span style="color:#9900CC;">XML</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#CC0066; font-weight:bold;">open</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;http://www.exemplo.com/exemplo.xml&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span><span style="color:#006600; font-weight:bold;">&#41;</span></pre></td></tr></table></div>



<p style="text-align: justify;">Concordam comigo que o código acima, é uma simples aplicação em ruby ? O que eu quero dizer é que você pode instalar o <strong>hpricot</strong> de várias maneiras diferentes ! Por exemplo, acessando o link: <a title="http://wiki.github.com/why/hpricot/installing-hpricot" href="http://wiki.github.com/why/hpricot/installing-hpricot" target="_blank">http://wiki.github.com/why/hpricot/installing-hpricot</a>, você pode observar que o Hpricot pode ser instalado sem o Rubygems. Sendo assim, ao usar o <strong>require &#8220;rubygems&#8221;</strong> em um máquina que não tem o rubygems instalado, vai dar problema na execução !</p>
<p style="text-align: justify;">Então o que fazer se eu instalei o Hpricot pelo rubygems ? Simples&#8230;<br /><br />Você pode facilmente rodar o seu script incluindo <span style="color: #ff0000;">-rubygems</span> na linha de comando, conforme o exemplo abaixo:</p>
<p style="text-align: justify;">ruby <span style="color: #ff0000;">-rubygems</span> meu_script.rb</p>
<p style="text-align: justify;">Isso fará rodar o pacote rubygems antes de executar sua aplicação meu_script.rb</p>
<p>Fonte: <a title="http://gist.github.com/54177" href="http://gist.github.com/54177" target="_blank">http://gist.github.com/54177</a></p>
<p>Bom, então é isso.<a title="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html#comments" href="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html#comments" target="_blank"></a></p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_9"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2009/04/29/ruby-require-rubygems-alternativas.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2009/04/29/ruby-require-rubygems-alternativas.html" data-text="Ruby: Alternativas para require ‘rubygems’"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F04%2F29%2Fruby-require-rubygems-alternativas.html&amp;linkname=Ruby%3A%20Alternativas%20para%20require%20%E2%80%98rubygems%E2%80%99" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F04%2F29%2Fruby-require-rubygems-alternativas.html&amp;linkname=Ruby%3A%20Alternativas%20para%20require%20%E2%80%98rubygems%E2%80%99" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/codigo" rel="tag">codigo</a><a href="https://rafaelbiriba.com/tag/desenvolvimento" rel="tag">Desenvolvimento</a><a href="https://rafaelbiriba.com/tag/hpricot" rel="tag">hpricot</a><a href="https://rafaelbiriba.com/tag/programacao" rel="tag">programação</a><a href="https://rafaelbiriba.com/tag/ruby" rel="tag">Ruby</a><a href="https://rafaelbiriba.com/tag/ruby-on-rails" rel="tag">ruby on rails</a><a href="https://rafaelbiriba.com/tag/rubygems" rel="tag">rubygems</a><a href="https://rafaelbiriba.com/tag/rubyonrails" rel="tag">rubyonrails</a><a href="https://rafaelbiriba.com/tag/web" rel="tag">web</a></span></footer></article><!-- #post-## -->

<article id="post-405" class="post-405 post type-post status-publish format-standard hentry category-desenvolvimento category-ruby tag-codigo tag-desenvolvimento tag-hpricot tag-online tag-programacao tag-programar tag-rails tag-ruby tag-rubygems tag-rubyonrails tag-tecnologia tag-web">
	
	<header class="entry-header">
				<div class="entry-meta">
			<span class="cat-links"><a href="https://rafaelbiriba.com/category/desenvolvimento" rel="category tag">Desenvolvimento</a>, <a href="https://rafaelbiriba.com/category/desenvolvimento/ruby" rel="category tag">Ruby</a></span>
		</div>
		<h1 class="entry-title"><a href="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html" rel="bookmark">Ruby: require &#8216;rubygems&#8217;</a></h1>
		<div class="entry-meta">
			<span class="entry-date"><a href="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html" rel="bookmark"><time class="entry-date" datetime="2009-04-13T08:08:43+00:00">13/04/2009</time></a></span> <span class="byline"><span class="author vcard"><a class="url fn n" href="https://rafaelbiriba.com/author/rafael" rel="author">Rafael Biriba</a></span></span>			<span class="comments-link"><a href="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html#comments"><span class="dsq-postid" data-dsqidentifier="405 https://rafaelbiriba.com/?p=405">8 Comentários</span></a></span>
					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		
<p><img class="size-full wp-image-408 alignleft" title="ruby-logo-justruby" src="https://rafaelbiriba.com/wp-content/uploads/2009/04/ruby-logo-justruby.jpg" alt="ruby-logo-justruby" width="132" height="150" /></p>
<p style="text-align: justify;">Essa semana estive escrevendo alguns códigos usando <a title="https://rafaelbiriba.com/2009/04/04/ruby-aprenda-a-programar.html" href="https://rafaelbiriba.com/2009/04/04/ruby-aprenda-a-programar.html" target="_blank">Ruby on Rails</a>, e encontrei um problema, que demorei um pouco para descobrir sua solução, mas no fim se tratava de algo muito simples e lógico.</p>
<p style="text-align: justify;">Ao instalar o Rails e qualquer outro pacote pelo rubygems ( <strong>gem install hpricot</strong>, por exemplo), para importar esse pacote no código, é necessário importar a biblioteca do rubygems primeiro.</p>
<p style="text-align: justify;">Manual do RubyGems ( <a title="http://docs.rubygems.org/read/book/1" href="http://docs.rubygems.org/read/book/1" target="_blank">http://docs.rubygems.org/read/book/1</a> ).</p>
<p style="text-align: justify;">Na prática, eu estava utilizando o código abaixo:</p>


<div class="wp_syntax"><table><tr><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'hpricot'</span> 
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'open-uri'</span> 
meuXml = Hpricot.<span style="color:#9900CC;">XML</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#CC0066; font-weight:bold;">open</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;http://www.exemplo.com/exemplo.xml&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span><span style="color:#006600; font-weight:bold;">&#41;</span></pre></td></tr></table></div>



<p style="text-align: justify;"><span style="color: #ff0000;"><span style="color: #000000;">Este codigo abre uma URL, captura seu XML e armazena o conteúdo em uma variável ( string ).</span></span></p>
<p style="text-align: justify;"><span style="color: #ff0000;"><span style="color: #000000;">Porém, isso só é possível se incluir a biblioteca do rubygems. Verifique o código abaixo, desta vez, funcionando:</span></span></p>


<div class="wp_syntax"><table><tr><td class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'rubygems'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'hpricot'</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'open-uri'</span> 
meuXml = Hpricot.<span style="color:#9900CC;">XML</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#CC0066; font-weight:bold;">open</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;http://www.exemplo.com/exemplo.xml&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span><span style="color:#006600; font-weight:bold;">&#41;</span></pre></td></tr></table></div>



<p>&nbsp;</p>
<p style="text-align: justify;"><span style="color: #ff0000;"><span style="color: #000000;">Bom, então é isso !<br />&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;<br />Baseado no comentário recebido depois da publicação deste Post, visite também:<br /><a title="https://rafaelbiriba.com/2009/04/29/ruby-require-rubygems-alternativas.html" href="https://rafaelbiriba.com/2009/04/29/ruby-require-rubygems-alternativas.html" target="_blank">https://rafaelbiriba.com/2009/04/29/ruby-require-rubygems-alternativas.html</a></span> </span></p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_10"><a class="a2a_button_facebook_like addtoany_special_service" data-href="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html"></a><a class="a2a_button_twitter_tweet addtoany_special_service" data-url="https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html" data-text="Ruby: require ‘rubygems’"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F04%2F13%2Fruby-require-rubygems.html&amp;linkname=Ruby%3A%20require%20%E2%80%98rubygems%E2%80%99" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=http%3A%2F%2Fwww.rafaelbiriba.com%2F2009%2F04%2F13%2Fruby-require-rubygems.html&amp;linkname=Ruby%3A%20require%20%E2%80%98rubygems%E2%80%99" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"><img src="https://rafaelbiriba.com/wp-content/plugins/add-to-any/share_save_171_16.png" width="171" height="16" alt="Share"/></a></div></div>	</div><!-- .entry-content -->
	
	<footer class="entry-meta"><span class="tag-links"><a href="https://rafaelbiriba.com/tag/codigo" rel="tag">codigo</a><a href="https://rafaelbiriba.com/tag/desenvolvimento" rel="tag">Desenvolvimento</a><a href="https://rafaelbiriba.com/tag/hpricot" rel="tag">hpricot</a><a href="https://rafaelbiriba.com/tag/online" rel="tag">online</a><a href="https://rafaelbiriba.com/tag/programacao" rel="tag">programação</a><a href="https://rafaelbiriba.com/tag/programar" rel="tag">programar</a><a href="https://rafaelbiriba.com/tag/rails" rel="tag">rails</a><a href="https://rafaelbiriba.com/tag/ruby" rel="tag">Ruby</a><a href="https://rafaelbiriba.com/tag/rubygems" rel="tag">rubygems</a><a href="https://rafaelbiriba.com/tag/rubyonrails" rel="tag">rubyonrails</a><a href="https://rafaelbiriba.com/tag/tecnologia" rel="tag">Tecnologia</a><a href="https://rafaelbiriba.com/tag/web" rel="tag">web</a></span></footer></article><!-- #post-## -->
	<nav class="navigation paging-navigation" role="navigation">
		<h1 class="screen-reader-text">Navegação por posts</h1>
		<div class="pagination loop-pagination">
			<a class="prev page-numbers" href="https://rafaelbiriba.com/category/desenvolvimento/">&larr; Anterior</a>
<a class='page-numbers' href='https://rafaelbiriba.com/category/desenvolvimento/'>1</a>
<span class='page-numbers current'>2</span>
<a class='page-numbers' href='https://rafaelbiriba.com/category/desenvolvimento/page/3'>3</a>
<a class="next page-numbers" href="https://rafaelbiriba.com/category/desenvolvimento/page/3">Próximo &rarr;</a>		</div><!-- .pagination -->
	</nav><!-- .navigation -->
			</div><!-- #content -->
	</section><!-- #primary -->

<div id="content-sidebar" class="content-sidebar widget-area" role="complementary">
	<aside id="text-569858663" class="widget widget_text">			<div class="textwidget"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- vertical blog -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-9952848327781387"
     data-ad-slot="7274679989"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
		</aside></div><!-- #content-sidebar -->
<div id="secondary">
		<h2 class="site-description">Tecnologia e informação no lugar certo !</h2>
	
	
		<div id="primary-sidebar" class="primary-sidebar widget-area" role="complementary">
		<aside id="text-569858664" class="widget widget_text"><h1 class="widget-title">Blog Desatualizado</h1>			<div class="textwidget">Depois de muitos anos, está na hora de mudar!
Em breve um novo blog, muito melhor e com mais conteúdo!
Se você está lendo isso, tente acessar <a href="https://rafaelbiriba.com/blog" target="_blank">https://rafaelbiriba.com/blog</a> para ver se o novo blog já está disponível!! :)
Previsão de ir online: Agosto/2016</div>
		</aside><aside id="text-347930551" class="widget widget_text"><h1 class="widget-title">Sobre o Autor</h1>			<div class="textwidget"><img alt="" src="https://1.gravatar.com/avatar/908bb0e461d553752af1df7c5849df52?s=80&amp;d=&amp;r=G" class="avatar avatar-42 photo" height="80" width="80">
<div style="text-align: justify;"><strong>Rafael Biriba</strong>: Full Stack Web Developer since 2008 with experience in the development field using technologies like Ruby on Rails, PHP, HTML5, Javascript (Jquery / Backbone.js), Video encoding and delivery (Flash Media Server, Wowza, ffmpeg tools), Database SQL and NoSQL (Mysql, MongoDB, Redis), Virtualization and automation using virtualbox. With knowledge of development techniques and practices such as TDD, Domain Driven Design and Object Oriented Design.</div></div>
		</aside><aside id="github-profile-2" class="widget widget_github-profile"><aside><h1 class="widget-title">Github</h1><div class="github-widget" id="github-profile-2"><header class="github-widget-header"><img class="github-widget-company-logo" title="GitHub" src="https://assets-cdn.github.com/favicon.ico"/><div class="github-widget-header-text"><a class="github-widget-header-link" target="_blank" href="https://github.com/rafaelbiriba" title="View profile">rafaelbiriba (Rafael Biriba)</a></div></header><div class="github-widget-content"><a target="_blank" href="https://github.com/rafaelbiriba" title="View profile"><img class="github-profile-pic" src="https://avatars.githubusercontent.com/u/324743?v=3" style="border-radius: 5px"> <span class="github-names"> <p class="github-name">Rafael Biriba</p> <span class="github-username">rafaelbiriba</span> </span></a><div class="github-block github-vcard-stats"><a class="github-vcard-stat" target='_blank' href="https://github.com/rafaelbiriba/followers"><strong class="github-vcard-stat-count">30</strong><span class="text-muted">Followers</span></a><a class="github-vcard-stat" target='_blank' href="https://github.com/rafaelbiriba/following"><strong class="github-vcard-stat-count">9</strong><span class="text-muted">Following</span></a><div style="clear: both;"></div></div> </div></div></aside></aside><aside id="tag_cloud-2" class="widget widget_tag_cloud"><h1 class="widget-title">Nuvem de Tags</h1><div class="tagcloud"><a href='https://rafaelbiriba.com/tag/904' class='tag-link-127 tag-link-position-1' title='5 tópicos' style='font-size: 8pt;'>9.04</a>
<a href='https://rafaelbiriba.com/tag/armazenamento' class='tag-link-76 tag-link-position-2' title='7 tópicos' style='font-size: 11.36pt;'>armazenamento</a>
<a href='https://rafaelbiriba.com/tag/atualizando' class='tag-link-132 tag-link-position-3' title='5 tópicos' style='font-size: 8pt;'>atualizando</a>
<a href='https://rafaelbiriba.com/tag/atualizar' class='tag-link-130 tag-link-position-4' title='10 tópicos' style='font-size: 15.28pt;'>atualizar</a>
<a href='https://rafaelbiriba.com/tag/audio' class='tag-link-22 tag-link-position-5' title='10 tópicos' style='font-size: 15.28pt;'>audio</a>
<a href='https://rafaelbiriba.com/tag/blog' class='tag-link-188 tag-link-position-6' title='15 tópicos' style='font-size: 19.76pt;'>blog</a>
<a href='https://rafaelbiriba.com/tag/codec' class='tag-link-26 tag-link-position-7' title='12 tópicos' style='font-size: 17.24pt;'>codec</a>
<a href='https://rafaelbiriba.com/tag/codigo' class='tag-link-46 tag-link-position-8' title='9 tópicos' style='font-size: 14.16pt;'>codigo</a>
<a href='https://rafaelbiriba.com/tag/converter' class='tag-link-23 tag-link-position-9' title='12 tópicos' style='font-size: 17.24pt;'>converter</a>
<a href='https://rafaelbiriba.com/tag/decifrar' class='tag-link-79 tag-link-position-10' title='5 tópicos' style='font-size: 8pt;'>decifrar</a>
<a href='https://rafaelbiriba.com/tag/desenvolvimento' class='tag-link-487 tag-link-position-11' title='13 tópicos' style='font-size: 18.36pt;'>Desenvolvimento</a>
<a href='https://rafaelbiriba.com/tag/disco' class='tag-link-16 tag-link-position-12' title='6 tópicos' style='font-size: 9.96pt;'>disco</a>
<a href='https://rafaelbiriba.com/tag/estag' class='tag-link-173 tag-link-position-13' title='9 tópicos' style='font-size: 14.16pt;'>estag</a>
<a href='https://rafaelbiriba.com/tag/estagio' class='tag-link-168 tag-link-position-14' title='12 tópicos' style='font-size: 17.24pt;'>estágio</a>
<a href='https://rafaelbiriba.com/tag/faetec' class='tag-link-192 tag-link-position-15' title='8 tópicos' style='font-size: 12.76pt;'>faetec</a>
<a href='https://rafaelbiriba.com/tag/ffmpeg' class='tag-link-484 tag-link-position-16' title='12 tópicos' style='font-size: 17.24pt;'>FFmpeg</a>
<a href='https://rafaelbiriba.com/tag/game' class='tag-link-53 tag-link-position-17' title='5 tópicos' style='font-size: 8pt;'>game</a>
<a href='https://rafaelbiriba.com/tag/globocom' class='tag-link-171 tag-link-position-18' title='10 tópicos' style='font-size: 15.28pt;'>globo.com</a>
<a href='https://rafaelbiriba.com/tag/google' class='tag-link-40 tag-link-position-19' title='7 tópicos' style='font-size: 11.36pt;'>google</a>
<a href='https://rafaelbiriba.com/tag/gravar' class='tag-link-24 tag-link-position-20' title='9 tópicos' style='font-size: 14.16pt;'>gravar</a>
<a href='https://rafaelbiriba.com/tag/imagem' class='tag-link-29 tag-link-position-21' title='6 tópicos' style='font-size: 9.96pt;'>imagem</a>
<a href='https://rafaelbiriba.com/tag/inscricao' class='tag-link-170 tag-link-position-22' title='14 tópicos' style='font-size: 19.2pt;'>inscrição</a>
<a href='https://rafaelbiriba.com/tag/ist-rio' class='tag-link-191 tag-link-position-23' title='8 tópicos' style='font-size: 12.76pt;'>ist-rio</a>
<a href='https://rafaelbiriba.com/tag/leitura' class='tag-link-80 tag-link-position-24' title='7 tópicos' style='font-size: 11.36pt;'>leitura</a>
<a href='https://rafaelbiriba.com/tag/medieval' class='tag-link-55 tag-link-position-25' title='5 tópicos' style='font-size: 8pt;'>medieval</a>
<a href='https://rafaelbiriba.com/tag/multimedia' class='tag-link-27 tag-link-position-26' title='13 tópicos' style='font-size: 18.36pt;'>multimedia</a>
<a href='https://rafaelbiriba.com/tag/online' class='tag-link-51 tag-link-position-27' title='15 tópicos' style='font-size: 19.76pt;'>online</a>
<a href='https://rafaelbiriba.com/tag/oportunidade' class='tag-link-169 tag-link-position-28' title='10 tópicos' style='font-size: 15.28pt;'>oportunidade</a>
<a href='https://rafaelbiriba.com/tag/player' class='tag-link-34 tag-link-position-29' title='7 tópicos' style='font-size: 11.36pt;'>player</a>
<a href='https://rafaelbiriba.com/tag/processo-seletivo' class='tag-link-172 tag-link-position-30' title='14 tópicos' style='font-size: 19.2pt;'>processo seletivo</a>
<a href='https://rafaelbiriba.com/tag/ruby' class='tag-link-492 tag-link-position-31' title='10 tópicos' style='font-size: 15.28pt;'>Ruby</a>
<a href='https://rafaelbiriba.com/tag/rubygems' class='tag-link-103 tag-link-position-32' title='8 tópicos' style='font-size: 12.76pt;'>rubygems</a>
<a href='https://rafaelbiriba.com/tag/rubyonrails' class='tag-link-105 tag-link-position-33' title='5 tópicos' style='font-size: 8pt;'>rubyonrails</a>
<a href='https://rafaelbiriba.com/tag/sistema' class='tag-link-133 tag-link-position-34' title='5 tópicos' style='font-size: 8pt;'>sistema</a>
<a href='https://rafaelbiriba.com/tag/sistema-operacional' class='tag-link-12 tag-link-position-35' title='5 tópicos' style='font-size: 8pt;'>sistema operacional</a>
<a href='https://rafaelbiriba.com/tag/stream' class='tag-link-25 tag-link-position-36' title='8 tópicos' style='font-size: 12.76pt;'>stream</a>
<a href='https://rafaelbiriba.com/tag/tecnologia' class='tag-link-490 tag-link-position-37' title='17 tópicos' style='font-size: 21.44pt;'>Tecnologia</a>
<a href='https://rafaelbiriba.com/tag/travian' class='tag-link-49 tag-link-position-38' title='6 tópicos' style='font-size: 9.96pt;'>travian</a>
<a href='https://rafaelbiriba.com/tag/ubuntu' class='tag-link-11 tag-link-position-39' title='9 tópicos' style='font-size: 14.16pt;'>ubuntu</a>
<a href='https://rafaelbiriba.com/tag/versao' class='tag-link-129 tag-link-position-40' title='8 tópicos' style='font-size: 12.76pt;'>versão</a>
<a href='https://rafaelbiriba.com/tag/video' class='tag-link-21 tag-link-position-41' title='18 tópicos' style='font-size: 22pt;'>video</a>
<a href='https://rafaelbiriba.com/tag/virtual' class='tag-link-17 tag-link-position-42' title='6 tópicos' style='font-size: 9.96pt;'>virtual</a>
<a href='https://rafaelbiriba.com/tag/web' class='tag-link-15 tag-link-position-43' title='16 tópicos' style='font-size: 20.6pt;'>web</a>
<a href='https://rafaelbiriba.com/tag/web-browser' class='tag-link-56 tag-link-position-44' title='6 tópicos' style='font-size: 9.96pt;'>web browser</a>
<a href='https://rafaelbiriba.com/tag/wordpress' class='tag-link-494 tag-link-position-45' title='13 tópicos' style='font-size: 18.36pt;'>Wordpress</a></div>
</aside>	</div><!-- #primary-sidebar -->
	</div><!-- #secondary -->

		<div class="cbd"></div>
		<script src="https://rafaelbiriba.com/wp-content/plugins/shutter-reloaded//shutter-reloaded.js?ver=2.5" type="text/javascript"></script>
	<script type="text/javascript">
	var shutterSettings = {"imgDir":"http:\/\/www.rafaelbiriba.com\/wp-content\/plugins\/shutter-reloaded\/\/menu\/","imageCount":true,"FS":false,"textBtns":true,"oneSet":true};
	try{}catch(e){}	</script>
	
		</div><!-- #main -->

		<footer id="colophon" class="site-footer" role="contentinfo">

			
			<div class="site-info">
								<a href="https://br.wordpress.org/">Orgulhosamente mantido com WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- #colophon -->
	</div><!-- #page -->

	
<script type="text/javascript"><!--
wpa2a.targets=[
{title:"HTML5: Trocando mensagens entre a p\u00e1gina e iframes",url:"https://rafaelbiriba.com/2010/11/27/html5-trocando-mensagens-entre-a-pagina-e-iframes.html"},
{title:"Net-SFTP: Calculando o progresso do upload",url:"https://rafaelbiriba.com/2010/11/18/net-sftp-calculando-o-progresso-do-upload.html"},
{title:"Net-sftp: Solu\u00e7\u00e3o para timeout durante o upload",url:"https://rafaelbiriba.com/2010/09/24/problema-no-net-sftp-timeout-para-o-upload.html"},
{title:"FFmpeg: Batch para convers\u00e3o de v\u00eddeos para iPhone [Windows]",url:"https://rafaelbiriba.com/2010/03/19/ffmpeg-batch-para-conversao-de-videos-para-iphone-windows.html"},
{title:"Cloud Crowd: A primeira action",url:"https://rafaelbiriba.com/2010/02/08/cloud-crowd-a-primeira-action.html"},
{title:"Feliz ano novo com javascript !",url:"https://rafaelbiriba.com/2009/12/24/feliz-ano-novo-com-javascript.html"},
{title:"PHP: Arquivo de log personalizado",url:"https://rafaelbiriba.com/2009/07/02/php-arquivo-de-log-personalizado.html"},
{title:"QR Code: Gere com o Google Chart API",url:"https://rafaelbiriba.com/2009/05/02/qr-code-gere-com-o-google-chart-api.html"},
{title:"Ruby: Alternativas para require \u2018rubygems\u2019",url:"https://rafaelbiriba.com/2009/04/29/ruby-require-rubygems-alternativas.html"},
{title:"Ruby: require \u2018rubygems\u2019",url:"https://rafaelbiriba.com/2009/04/13/ruby-require-rubygems.html"}];
wpa2a.html_done=true;if(wpa2a.script_ready&&!wpa2a.done)wpa2a.init();wpa2a.script_load();
//--></script>
<script type='text/javascript'>
/* <![CDATA[ */
var scriptParams = {"google_search_engine_id":"partner-pub-9952848327781387:5952361189"};
/* ]]> */
</script>
<script type='text/javascript' src='https://rafaelbiriba.com/wp-content/plugins/wp-google-search/assets/js/google_cse_v2.js?ver=1'></script>
<script type='text/javascript' src='https://rafaelbiriba.com/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js?ver=3.51.0-2014.06.20'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/www.rafaelbiriba.com\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","recaptchaEmpty":"Please verify that you are not a robot.","sending":"Enviando ..."};
/* ]]> */
</script>
<script type='text/javascript' src='https://rafaelbiriba.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.4.2'></script>
<script type='text/javascript' src='https://rafaelbiriba.com/wp-content/themes/twentyfourteen/js/functions.js?ver=20150315'></script>
<script type='text/javascript' src='https://rafaelbiriba.com/wp-includes/js/wp-embed.min.js?ver=4.5.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"rafaelbiriba"};
/* ]]> */
</script>
<script type='text/javascript' src='https://rafaelbiriba.com/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.5.3'></script>
</body>
</html>